{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@tudor/read-mode/./node_modules/@mozilla/readability/Readability-readerable.js","webpack://@tudor/read-mode/./node_modules/@mozilla/readability/Readability.js","webpack://@tudor/read-mode/./node_modules/@mozilla/readability/index.js","webpack://@tudor/read-mode/./src/common/index.ts","webpack://@tudor/read-mode/./src/forum/components/ArticleModal.js","webpack://@tudor/read-mode/./src/forum/index.js","webpack://@tudor/read-mode/./src/forum/utils/getBrowser.ts","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/Model']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/app']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/components/Button']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/components/Separator']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/components/SplitDropdown']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/extend']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['components/LoadingPost']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['components/Modal']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['components/PostEdited']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['components/PostMeta']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['components/PostUser']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['forum/app']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['utils/ItemList']\"","webpack://@tudor/read-mode/external root \"flarum.core.compat['utils/PostControls']\"","webpack://@tudor/read-mode/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@tudor/read-mode/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@tudor/read-mode/webpack/bootstrap","webpack://@tudor/read-mode/webpack/runtime/compat get default export","webpack://@tudor/read-mode/webpack/runtime/define property getters","webpack://@tudor/read-mode/webpack/runtime/hasOwnProperty shorthand","webpack://@tudor/read-mode/webpack/runtime/make namespace object","webpack://@tudor/read-mode/./forum.ts"],"sourcesContent":["/* eslint-env es6:false */\n/*\n * Copyright (c) 2010 Arc90 Inc\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\n * This code is heavily based on Arc90's readability.js (1.7.1) script\n * available at: http://code.google.com/p/arc90labs-readability\n */\n\nvar REGEXPS = {\n  // NOTE: These two regular expressions are duplicated in\n  // Readability.js. Please keep both copies in sync.\n  unlikelyCandidates: /-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,\n  okMaybeItsACandidate: /and|article|body|column|content|main|shadow/i,\n};\n\nfunction isNodeVisible(node) {\n  // Have to null-check node.style and node.className.indexOf to deal with SVG and MathML nodes.\n  return (!node.style || node.style.display != \"none\")\n    && !node.hasAttribute(\"hidden\")\n    //check for \"fallback-image\" so that wikimedia math images are displayed\n    && (!node.hasAttribute(\"aria-hidden\") || node.getAttribute(\"aria-hidden\") != \"true\" || (node.className && node.className.indexOf && node.className.indexOf(\"fallback-image\") !== -1));\n}\n\n/**\n * Decides whether or not the document is reader-able without parsing the whole thing.\n * @param {Object} options Configuration object.\n * @param {number} [options.minContentLength=140] The minimum node content length used to decide if the document is readerable.\n * @param {number} [options.minScore=20] The minumum cumulated 'score' used to determine if the document is readerable.\n * @param {Function} [options.visibilityChecker=isNodeVisible] The function used to determine if a node is visible.\n * @return {boolean} Whether or not we suspect Readability.parse() will suceeed at returning an article object.\n */\nfunction isProbablyReaderable(doc, options = {}) {\n  // For backward compatibility reasons 'options' can either be a configuration object or the function used\n  // to determine if a node is visible.\n  if (typeof options == \"function\") {\n    options = { visibilityChecker: options };\n  }\n\n  var defaultOptions = { minScore: 20, minContentLength: 140, visibilityChecker: isNodeVisible };\n  options = Object.assign(defaultOptions, options);\n\n  var nodes = doc.querySelectorAll(\"p, pre, article\");\n\n  // Get <div> nodes which have <br> node(s) and append them into the `nodes` variable.\n  // Some articles' DOM structures might look like\n  // <div>\n  //   Sentences<br>\n  //   <br>\n  //   Sentences<br>\n  // </div>\n  var brNodes = doc.querySelectorAll(\"div > br\");\n  if (brNodes.length) {\n    var set = new Set(nodes);\n    [].forEach.call(brNodes, function (node) {\n      set.add(node.parentNode);\n    });\n    nodes = Array.from(set);\n  }\n\n  var score = 0;\n  // This is a little cheeky, we use the accumulator 'score' to decide what to return from\n  // this callback:\n  return [].some.call(nodes, function (node) {\n    if (!options.visibilityChecker(node)) {\n      return false;\n    }\n\n    var matchString = node.className + \" \" + node.id;\n    if (REGEXPS.unlikelyCandidates.test(matchString) &&\n        !REGEXPS.okMaybeItsACandidate.test(matchString)) {\n      return false;\n    }\n\n    if (node.matches(\"li p\")) {\n      return false;\n    }\n\n    var textContentLength = node.textContent.trim().length;\n    if (textContentLength < options.minContentLength) {\n      return false;\n    }\n\n    score += Math.sqrt(textContentLength - options.minContentLength);\n\n    if (score > options.minScore) {\n      return true;\n    }\n    return false;\n  });\n}\n\nif (typeof module === \"object\") {\n  module.exports = isProbablyReaderable;\n}\n","/*eslint-env es6:false*/\n/*\n * Copyright (c) 2010 Arc90 Inc\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\n * This code is heavily based on Arc90's readability.js (1.7.1) script\n * available at: http://code.google.com/p/arc90labs-readability\n */\n\n/**\n * Public constructor.\n * @param {HTMLDocument} doc     The document to parse.\n * @param {Object}       options The options object.\n */\nfunction Readability(doc, options) {\n  // In some older versions, people passed a URI as the first argument. Cope:\n  if (options && options.documentElement) {\n    doc = options;\n    options = arguments[2];\n  } else if (!doc || !doc.documentElement) {\n    throw new Error(\"First argument to Readability constructor should be a document object.\");\n  }\n  options = options || {};\n\n  this._doc = doc;\n  this._docJSDOMParser = this._doc.firstChild.__JSDOMParser__;\n  this._articleTitle = null;\n  this._articleByline = null;\n  this._articleDir = null;\n  this._articleSiteName = null;\n  this._attempts = [];\n\n  // Configurable options\n  this._debug = !!options.debug;\n  this._maxElemsToParse = options.maxElemsToParse || this.DEFAULT_MAX_ELEMS_TO_PARSE;\n  this._nbTopCandidates = options.nbTopCandidates || this.DEFAULT_N_TOP_CANDIDATES;\n  this._charThreshold = options.charThreshold || this.DEFAULT_CHAR_THRESHOLD;\n  this._classesToPreserve = this.CLASSES_TO_PRESERVE.concat(options.classesToPreserve || []);\n  this._keepClasses = !!options.keepClasses;\n  this._serializer = options.serializer || function(el) {\n    return el.innerHTML;\n  };\n  this._disableJSONLD = !!options.disableJSONLD;\n\n  // Start with all flags set\n  this._flags = this.FLAG_STRIP_UNLIKELYS |\n                this.FLAG_WEIGHT_CLASSES |\n                this.FLAG_CLEAN_CONDITIONALLY;\n\n\n  // Control whether log messages are sent to the console\n  if (this._debug) {\n    let logNode = function(node) {\n      if (node.nodeType == node.TEXT_NODE) {\n        return `${node.nodeName} (\"${node.textContent}\")`;\n      }\n      let attrPairs = Array.from(node.attributes || [], function(attr) {\n        return `${attr.name}=\"${attr.value}\"`;\n      }).join(\" \");\n      return `<${node.localName} ${attrPairs}>`;\n    };\n    this.log = function () {\n      if (typeof dump !== \"undefined\") {\n        var msg = Array.prototype.map.call(arguments, function(x) {\n          return (x && x.nodeName) ? logNode(x) : x;\n        }).join(\" \");\n        dump(\"Reader: (Readability) \" + msg + \"\\n\");\n      } else if (typeof console !== \"undefined\") {\n        let args = Array.from(arguments, arg => {\n          if (arg && arg.nodeType == this.ELEMENT_NODE) {\n            return logNode(arg);\n          }\n          return arg;\n        });\n        args.unshift(\"Reader: (Readability)\");\n        console.log.apply(console, args);\n      }\n    };\n  } else {\n    this.log = function () {};\n  }\n}\n\nReadability.prototype = {\n  FLAG_STRIP_UNLIKELYS: 0x1,\n  FLAG_WEIGHT_CLASSES: 0x2,\n  FLAG_CLEAN_CONDITIONALLY: 0x4,\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n  ELEMENT_NODE: 1,\n  TEXT_NODE: 3,\n\n  // Max number of nodes supported by this parser. Default: 0 (no limit)\n  DEFAULT_MAX_ELEMS_TO_PARSE: 0,\n\n  // The number of top candidates to consider when analysing how\n  // tight the competition is among candidates.\n  DEFAULT_N_TOP_CANDIDATES: 5,\n\n  // Element tags to score by default.\n  DEFAULT_TAGS_TO_SCORE: \"section,h2,h3,h4,h5,h6,p,td,pre\".toUpperCase().split(\",\"),\n\n  // The default number of chars an article must have in order to return a result\n  DEFAULT_CHAR_THRESHOLD: 500,\n\n  // All of the regular expressions in use within readability.\n  // Defined up here so we don't instantiate them repeatedly in loops.\n  REGEXPS: {\n    // NOTE: These two regular expressions are duplicated in\n    // Readability-readerable.js. Please keep both copies in sync.\n    unlikelyCandidates: /-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,\n    okMaybeItsACandidate: /and|article|body|column|content|main|shadow/i,\n\n    positive: /article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,\n    negative: /-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,\n    extraneous: /print|archive|comment|discuss|e[\\-]?mail|share|reply|all|login|sign|single|utility/i,\n    byline: /byline|author|dateline|writtenby|p-author/i,\n    replaceFonts: /<(\\/?)font[^>]*>/gi,\n    normalize: /\\s{2,}/g,\n    videos: /\\/\\/(www\\.)?((dailymotion|youtube|youtube-nocookie|player\\.vimeo|v\\.qq)\\.com|(archive|upload\\.wikimedia)\\.org|player\\.twitch\\.tv)/i,\n    shareElements: /(\\b|_)(share|sharedaddy)(\\b|_)/i,\n    nextLink: /(next|weiter|continue|>([^\\|]|$)|([^\\|]|$))/i,\n    prevLink: /(prev|earl|old|new|<|)/i,\n    tokenize: /\\W+/g,\n    whitespace: /^\\s*$/,\n    hasContent: /\\S$/,\n    hashUrl: /^#.+/,\n    srcsetUrl: /(\\S+)(\\s+[\\d.]+[xw])?(\\s*(?:,|$))/g,\n    b64DataUrl: /^data:\\s*([^\\s;,]+)\\s*;\\s*base64\\s*,/i,\n    // See: https://schema.org/Article\n    jsonLdArticleTypes: /^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/\n  },\n\n  UNLIKELY_ROLES: [ \"menu\", \"menubar\", \"complementary\", \"navigation\", \"alert\", \"alertdialog\", \"dialog\" ],\n\n  DIV_TO_P_ELEMS: new Set([ \"BLOCKQUOTE\", \"DL\", \"DIV\", \"IMG\", \"OL\", \"P\", \"PRE\", \"TABLE\", \"UL\" ]),\n\n  ALTER_TO_DIV_EXCEPTIONS: [\"DIV\", \"ARTICLE\", \"SECTION\", \"P\"],\n\n  PRESENTATIONAL_ATTRIBUTES: [ \"align\", \"background\", \"bgcolor\", \"border\", \"cellpadding\", \"cellspacing\", \"frame\", \"hspace\", \"rules\", \"style\", \"valign\", \"vspace\" ],\n\n  DEPRECATED_SIZE_ATTRIBUTE_ELEMS: [ \"TABLE\", \"TH\", \"TD\", \"HR\", \"PRE\" ],\n\n  // The commented out elements qualify as phrasing content but tend to be\n  // removed by readability when put into paragraphs, so we ignore them here.\n  PHRASING_ELEMS: [\n    // \"CANVAS\", \"IFRAME\", \"SVG\", \"VIDEO\",\n    \"ABBR\", \"AUDIO\", \"B\", \"BDO\", \"BR\", \"BUTTON\", \"CITE\", \"CODE\", \"DATA\",\n    \"DATALIST\", \"DFN\", \"EM\", \"EMBED\", \"I\", \"IMG\", \"INPUT\", \"KBD\", \"LABEL\",\n    \"MARK\", \"MATH\", \"METER\", \"NOSCRIPT\", \"OBJECT\", \"OUTPUT\", \"PROGRESS\", \"Q\",\n    \"RUBY\", \"SAMP\", \"SCRIPT\", \"SELECT\", \"SMALL\", \"SPAN\", \"STRONG\", \"SUB\",\n    \"SUP\", \"TEXTAREA\", \"TIME\", \"VAR\", \"WBR\"\n  ],\n\n  // These are the classes that readability sets itself.\n  CLASSES_TO_PRESERVE: [ \"page\" ],\n\n  // These are the list of HTML entities that need to be escaped.\n  HTML_ESCAPE_MAP: {\n    \"lt\": \"<\",\n    \"gt\": \">\",\n    \"amp\": \"&\",\n    \"quot\": '\"',\n    \"apos\": \"'\",\n  },\n\n  /**\n   * Run any post-process modifications to article content as necessary.\n   *\n   * @param Element\n   * @return void\n  **/\n  _postProcessContent: function(articleContent) {\n    // Readability cannot open relative uris so we convert them to absolute uris.\n    this._fixRelativeUris(articleContent);\n\n    this._simplifyNestedElements(articleContent);\n\n    if (!this._keepClasses) {\n      // Remove classes.\n      this._cleanClasses(articleContent);\n    }\n  },\n\n  /**\n   * Iterates over a NodeList, calls `filterFn` for each node and removes node\n   * if function returned `true`.\n   *\n   * If function is not passed, removes all the nodes in node list.\n   *\n   * @param NodeList nodeList The nodes to operate on\n   * @param Function filterFn the function to use as a filter\n   * @return void\n   */\n  _removeNodes: function(nodeList, filterFn) {\n    // Avoid ever operating on live node lists.\n    if (this._docJSDOMParser && nodeList._isLiveNodeList) {\n      throw new Error(\"Do not pass live node lists to _removeNodes\");\n    }\n    for (var i = nodeList.length - 1; i >= 0; i--) {\n      var node = nodeList[i];\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        if (!filterFn || filterFn.call(this, node, i, nodeList)) {\n          parentNode.removeChild(node);\n        }\n      }\n    }\n  },\n\n  /**\n   * Iterates over a NodeList, and calls _setNodeTag for each node.\n   *\n   * @param NodeList nodeList The nodes to operate on\n   * @param String newTagName the new tag name to use\n   * @return void\n   */\n  _replaceNodeTags: function(nodeList, newTagName) {\n    // Avoid ever operating on live node lists.\n    if (this._docJSDOMParser && nodeList._isLiveNodeList) {\n      throw new Error(\"Do not pass live node lists to _replaceNodeTags\");\n    }\n    for (const node of nodeList) {\n      this._setNodeTag(node, newTagName);\n    }\n  },\n\n  /**\n   * Iterate over a NodeList, which doesn't natively fully implement the Array\n   * interface.\n   *\n   * For convenience, the current object context is applied to the provided\n   * iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return void\n   */\n  _forEachNode: function(nodeList, fn) {\n    Array.prototype.forEach.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, and return the first node that passes\n   * the supplied test function\n   *\n   * For convenience, the current object context is applied to the provided\n   * test function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The test function.\n   * @return void\n   */\n  _findNode: function(nodeList, fn) {\n    return Array.prototype.find.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, return true if any of the provided iterate\n   * function calls returns true, false otherwise.\n   *\n   * For convenience, the current object context is applied to the\n   * provided iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return Boolean\n   */\n  _someNode: function(nodeList, fn) {\n    return Array.prototype.some.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, return true if all of the provided iterate\n   * function calls return true, false otherwise.\n   *\n   * For convenience, the current object context is applied to the\n   * provided iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return Boolean\n   */\n  _everyNode: function(nodeList, fn) {\n    return Array.prototype.every.call(nodeList, fn, this);\n  },\n\n  /**\n   * Concat all nodelists passed as arguments.\n   *\n   * @return ...NodeList\n   * @return Array\n   */\n  _concatNodeLists: function() {\n    var slice = Array.prototype.slice;\n    var args = slice.call(arguments);\n    var nodeLists = args.map(function(list) {\n      return slice.call(list);\n    });\n    return Array.prototype.concat.apply([], nodeLists);\n  },\n\n  _getAllNodesWithTag: function(node, tagNames) {\n    if (node.querySelectorAll) {\n      return node.querySelectorAll(tagNames.join(\",\"));\n    }\n    return [].concat.apply([], tagNames.map(function(tag) {\n      var collection = node.getElementsByTagName(tag);\n      return Array.isArray(collection) ? collection : Array.from(collection);\n    }));\n  },\n\n  /**\n   * Removes the class=\"\" attribute from every element in the given\n   * subtree, except those that match CLASSES_TO_PRESERVE and\n   * the classesToPreserve array from the options object.\n   *\n   * @param Element\n   * @return void\n   */\n  _cleanClasses: function(node) {\n    var classesToPreserve = this._classesToPreserve;\n    var className = (node.getAttribute(\"class\") || \"\")\n      .split(/\\s+/)\n      .filter(function(cls) {\n        return classesToPreserve.indexOf(cls) != -1;\n      })\n      .join(\" \");\n\n    if (className) {\n      node.setAttribute(\"class\", className);\n    } else {\n      node.removeAttribute(\"class\");\n    }\n\n    for (node = node.firstElementChild; node; node = node.nextElementSibling) {\n      this._cleanClasses(node);\n    }\n  },\n\n  /**\n   * Converts each <a> and <img> uri in the given element to an absolute URI,\n   * ignoring #ref URIs.\n   *\n   * @param Element\n   * @return void\n   */\n  _fixRelativeUris: function(articleContent) {\n    var baseURI = this._doc.baseURI;\n    var documentURI = this._doc.documentURI;\n    function toAbsoluteURI(uri) {\n      // Leave hash links alone if the base URI matches the document URI:\n      if (baseURI == documentURI && uri.charAt(0) == \"#\") {\n        return uri;\n      }\n\n      // Otherwise, resolve against base URI:\n      try {\n        return new URL(uri, baseURI).href;\n      } catch (ex) {\n        // Something went wrong, just return the original:\n      }\n      return uri;\n    }\n\n    var links = this._getAllNodesWithTag(articleContent, [\"a\"]);\n    this._forEachNode(links, function(link) {\n      var href = link.getAttribute(\"href\");\n      if (href) {\n        // Remove links with javascript: URIs, since\n        // they won't work after scripts have been removed from the page.\n        if (href.indexOf(\"javascript:\") === 0) {\n          // if the link only contains simple text content, it can be converted to a text node\n          if (link.childNodes.length === 1 && link.childNodes[0].nodeType === this.TEXT_NODE) {\n            var text = this._doc.createTextNode(link.textContent);\n            link.parentNode.replaceChild(text, link);\n          } else {\n            // if the link has multiple children, they should all be preserved\n            var container = this._doc.createElement(\"span\");\n            while (link.firstChild) {\n              container.appendChild(link.firstChild);\n            }\n            link.parentNode.replaceChild(container, link);\n          }\n        } else {\n          link.setAttribute(\"href\", toAbsoluteURI(href));\n        }\n      }\n    });\n\n    var medias = this._getAllNodesWithTag(articleContent, [\n      \"img\", \"picture\", \"figure\", \"video\", \"audio\", \"source\"\n    ]);\n\n    this._forEachNode(medias, function(media) {\n      var src = media.getAttribute(\"src\");\n      var poster = media.getAttribute(\"poster\");\n      var srcset = media.getAttribute(\"srcset\");\n\n      if (src) {\n        media.setAttribute(\"src\", toAbsoluteURI(src));\n      }\n\n      if (poster) {\n        media.setAttribute(\"poster\", toAbsoluteURI(poster));\n      }\n\n      if (srcset) {\n        var newSrcset = srcset.replace(this.REGEXPS.srcsetUrl, function(_, p1, p2, p3) {\n          return toAbsoluteURI(p1) + (p2 || \"\") + p3;\n        });\n\n        media.setAttribute(\"srcset\", newSrcset);\n      }\n    });\n  },\n\n  _simplifyNestedElements: function(articleContent) {\n    var node = articleContent;\n\n    while (node) {\n      if (node.parentNode && [\"DIV\", \"SECTION\"].includes(node.tagName) && !(node.id && node.id.startsWith(\"readability\"))) {\n        if (this._isElementWithoutContent(node)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        } else if (this._hasSingleTagInsideElement(node, \"DIV\") || this._hasSingleTagInsideElement(node, \"SECTION\")) {\n          var child = node.children[0];\n          for (var i = 0; i < node.attributes.length; i++) {\n            child.setAttribute(node.attributes[i].name, node.attributes[i].value);\n          }\n          node.parentNode.replaceChild(child, node);\n          node = child;\n          continue;\n        }\n      }\n\n      node = this._getNextNode(node);\n    }\n  },\n\n  /**\n   * Get the article title as an H1.\n   *\n   * @return string\n   **/\n  _getArticleTitle: function() {\n    var doc = this._doc;\n    var curTitle = \"\";\n    var origTitle = \"\";\n\n    try {\n      curTitle = origTitle = doc.title.trim();\n\n      // If they had an element with id \"title\" in their HTML\n      if (typeof curTitle !== \"string\")\n        curTitle = origTitle = this._getInnerText(doc.getElementsByTagName(\"title\")[0]);\n    } catch (e) {/* ignore exceptions setting the title. */}\n\n    var titleHadHierarchicalSeparators = false;\n    function wordCount(str) {\n      return str.split(/\\s+/).length;\n    }\n\n    // If there's a separator in the title, first remove the final part\n    if ((/ [\\|\\-\\\\\\/>] /).test(curTitle)) {\n      titleHadHierarchicalSeparators = / [\\\\\\/>] /.test(curTitle);\n      curTitle = origTitle.replace(/(.*)[\\|\\-\\\\\\/>] .*/gi, \"$1\");\n\n      // If the resulting title is too short (3 words or fewer), remove\n      // the first part instead:\n      if (wordCount(curTitle) < 3)\n        curTitle = origTitle.replace(/[^\\|\\-\\\\\\/>]*[\\|\\-\\\\\\/>](.*)/gi, \"$1\");\n    } else if (curTitle.indexOf(\": \") !== -1) {\n      // Check if we have an heading containing this exact string, so we\n      // could assume it's the full title.\n      var headings = this._concatNodeLists(\n        doc.getElementsByTagName(\"h1\"),\n        doc.getElementsByTagName(\"h2\")\n      );\n      var trimmedTitle = curTitle.trim();\n      var match = this._someNode(headings, function(heading) {\n        return heading.textContent.trim() === trimmedTitle;\n      });\n\n      // If we don't, let's extract the title out of the original title string.\n      if (!match) {\n        curTitle = origTitle.substring(origTitle.lastIndexOf(\":\") + 1);\n\n        // If the title is now too short, try the first colon instead:\n        if (wordCount(curTitle) < 3) {\n          curTitle = origTitle.substring(origTitle.indexOf(\":\") + 1);\n          // But if we have too many words before the colon there's something weird\n          // with the titles and the H tags so let's just use the original title instead\n        } else if (wordCount(origTitle.substr(0, origTitle.indexOf(\":\"))) > 5) {\n          curTitle = origTitle;\n        }\n      }\n    } else if (curTitle.length > 150 || curTitle.length < 15) {\n      var hOnes = doc.getElementsByTagName(\"h1\");\n\n      if (hOnes.length === 1)\n        curTitle = this._getInnerText(hOnes[0]);\n    }\n\n    curTitle = curTitle.trim().replace(this.REGEXPS.normalize, \" \");\n    // If we now have 4 words or fewer as our title, and either no\n    // 'hierarchical' separators (\\, /, > or ) were found in the original\n    // title or we decreased the number of words by more than 1 word, use\n    // the original title.\n    var curTitleWordCount = wordCount(curTitle);\n    if (curTitleWordCount <= 4 &&\n        (!titleHadHierarchicalSeparators ||\n         curTitleWordCount != wordCount(origTitle.replace(/[\\|\\-\\\\\\/>]+/g, \"\")) - 1)) {\n      curTitle = origTitle;\n    }\n\n    return curTitle;\n  },\n\n  /**\n   * Prepare the HTML document for readability to scrape it.\n   * This includes things like stripping javascript, CSS, and handling terrible markup.\n   *\n   * @return void\n   **/\n  _prepDocument: function() {\n    var doc = this._doc;\n\n    // Remove all style tags in head\n    this._removeNodes(this._getAllNodesWithTag(doc, [\"style\"]));\n\n    if (doc.body) {\n      this._replaceBrs(doc.body);\n    }\n\n    this._replaceNodeTags(this._getAllNodesWithTag(doc, [\"font\"]), \"SPAN\");\n  },\n\n  /**\n   * Finds the next node, starting from the given node, and ignoring\n   * whitespace in between. If the given node is an element, the same node is\n   * returned.\n   */\n  _nextNode: function (node) {\n    var next = node;\n    while (next\n        && (next.nodeType != this.ELEMENT_NODE)\n        && this.REGEXPS.whitespace.test(next.textContent)) {\n      next = next.nextSibling;\n    }\n    return next;\n  },\n\n  /**\n   * Replaces 2 or more successive <br> elements with a single <p>.\n   * Whitespace between <br> elements are ignored. For example:\n   *   <div>foo<br>bar<br> <br><br>abc</div>\n   * will become:\n   *   <div>foo<br>bar<p>abc</p></div>\n   */\n  _replaceBrs: function (elem) {\n    this._forEachNode(this._getAllNodesWithTag(elem, [\"br\"]), function(br) {\n      var next = br.nextSibling;\n\n      // Whether 2 or more <br> elements have been found and replaced with a\n      // <p> block.\n      var replaced = false;\n\n      // If we find a <br> chain, remove the <br>s until we hit another node\n      // or non-whitespace. This leaves behind the first <br> in the chain\n      // (which will be replaced with a <p> later).\n      while ((next = this._nextNode(next)) && (next.tagName == \"BR\")) {\n        replaced = true;\n        var brSibling = next.nextSibling;\n        next.parentNode.removeChild(next);\n        next = brSibling;\n      }\n\n      // If we removed a <br> chain, replace the remaining <br> with a <p>. Add\n      // all sibling nodes as children of the <p> until we hit another <br>\n      // chain.\n      if (replaced) {\n        var p = this._doc.createElement(\"p\");\n        br.parentNode.replaceChild(p, br);\n\n        next = p.nextSibling;\n        while (next) {\n          // If we've hit another <br><br>, we're done adding children to this <p>.\n          if (next.tagName == \"BR\") {\n            var nextElem = this._nextNode(next.nextSibling);\n            if (nextElem && nextElem.tagName == \"BR\")\n              break;\n          }\n\n          if (!this._isPhrasingContent(next))\n            break;\n\n          // Otherwise, make this node a child of the new <p>.\n          var sibling = next.nextSibling;\n          p.appendChild(next);\n          next = sibling;\n        }\n\n        while (p.lastChild && this._isWhitespace(p.lastChild)) {\n          p.removeChild(p.lastChild);\n        }\n\n        if (p.parentNode.tagName === \"P\")\n          this._setNodeTag(p.parentNode, \"DIV\");\n      }\n    });\n  },\n\n  _setNodeTag: function (node, tag) {\n    this.log(\"_setNodeTag\", node, tag);\n    if (this._docJSDOMParser) {\n      node.localName = tag.toLowerCase();\n      node.tagName = tag.toUpperCase();\n      return node;\n    }\n\n    var replacement = node.ownerDocument.createElement(tag);\n    while (node.firstChild) {\n      replacement.appendChild(node.firstChild);\n    }\n    node.parentNode.replaceChild(replacement, node);\n    if (node.readability)\n      replacement.readability = node.readability;\n\n    for (var i = 0; i < node.attributes.length; i++) {\n      try {\n        replacement.setAttribute(node.attributes[i].name, node.attributes[i].value);\n      } catch (ex) {\n        /* it's possible for setAttribute() to throw if the attribute name\n         * isn't a valid XML Name. Such attributes can however be parsed from\n         * source in HTML docs, see https://github.com/whatwg/html/issues/4275,\n         * so we can hit them here and then throw. We don't care about such\n         * attributes so we ignore them.\n         */\n      }\n    }\n    return replacement;\n  },\n\n  /**\n   * Prepare the article node for display. Clean out any inline styles,\n   * iframes, forms, strip extraneous <p> tags, etc.\n   *\n   * @param Element\n   * @return void\n   **/\n  _prepArticle: function(articleContent) {\n    this._cleanStyles(articleContent);\n\n    // Check for data tables before we continue, to avoid removing items in\n    // those tables, which will often be isolated even though they're\n    // visually linked to other content-ful elements (text, images, etc.).\n    this._markDataTables(articleContent);\n\n    this._fixLazyImages(articleContent);\n\n    // Clean out junk from the article content\n    this._cleanConditionally(articleContent, \"form\");\n    this._cleanConditionally(articleContent, \"fieldset\");\n    this._clean(articleContent, \"object\");\n    this._clean(articleContent, \"embed\");\n    this._clean(articleContent, \"footer\");\n    this._clean(articleContent, \"link\");\n    this._clean(articleContent, \"aside\");\n\n    // Clean out elements with little content that have \"share\" in their id/class combinations from final top candidates,\n    // which means we don't remove the top candidates even they have \"share\".\n\n    var shareElementThreshold = this.DEFAULT_CHAR_THRESHOLD;\n\n    this._forEachNode(articleContent.children, function (topCandidate) {\n      this._cleanMatchedNodes(topCandidate, function (node, matchString) {\n        return this.REGEXPS.shareElements.test(matchString) && node.textContent.length < shareElementThreshold;\n      });\n    });\n\n    this._clean(articleContent, \"iframe\");\n    this._clean(articleContent, \"input\");\n    this._clean(articleContent, \"textarea\");\n    this._clean(articleContent, \"select\");\n    this._clean(articleContent, \"button\");\n    this._cleanHeaders(articleContent);\n\n    // Do these last as the previous stuff may have removed junk\n    // that will affect these\n    this._cleanConditionally(articleContent, \"table\");\n    this._cleanConditionally(articleContent, \"ul\");\n    this._cleanConditionally(articleContent, \"div\");\n\n    // replace H1 with H2 as H1 should be only title that is displayed separately\n    this._replaceNodeTags(this._getAllNodesWithTag(articleContent, [\"h1\"]), \"h2\");\n\n    // Remove extra paragraphs\n    this._removeNodes(this._getAllNodesWithTag(articleContent, [\"p\"]), function (paragraph) {\n      var imgCount = paragraph.getElementsByTagName(\"img\").length;\n      var embedCount = paragraph.getElementsByTagName(\"embed\").length;\n      var objectCount = paragraph.getElementsByTagName(\"object\").length;\n      // At this point, nasty iframes have been removed, only remain embedded video ones.\n      var iframeCount = paragraph.getElementsByTagName(\"iframe\").length;\n      var totalCount = imgCount + embedCount + objectCount + iframeCount;\n\n      return totalCount === 0 && !this._getInnerText(paragraph, false);\n    });\n\n    this._forEachNode(this._getAllNodesWithTag(articleContent, [\"br\"]), function(br) {\n      var next = this._nextNode(br.nextSibling);\n      if (next && next.tagName == \"P\")\n        br.parentNode.removeChild(br);\n    });\n\n    // Remove single-cell tables\n    this._forEachNode(this._getAllNodesWithTag(articleContent, [\"table\"]), function(table) {\n      var tbody = this._hasSingleTagInsideElement(table, \"TBODY\") ? table.firstElementChild : table;\n      if (this._hasSingleTagInsideElement(tbody, \"TR\")) {\n        var row = tbody.firstElementChild;\n        if (this._hasSingleTagInsideElement(row, \"TD\")) {\n          var cell = row.firstElementChild;\n          cell = this._setNodeTag(cell, this._everyNode(cell.childNodes, this._isPhrasingContent) ? \"P\" : \"DIV\");\n          table.parentNode.replaceChild(cell, table);\n        }\n      }\n    });\n  },\n\n  /**\n   * Initialize a node with the readability object. Also checks the\n   * className/id for special names to add to its score.\n   *\n   * @param Element\n   * @return void\n  **/\n  _initializeNode: function(node) {\n    node.readability = {\"contentScore\": 0};\n\n    switch (node.tagName) {\n      case \"DIV\":\n        node.readability.contentScore += 5;\n        break;\n\n      case \"PRE\":\n      case \"TD\":\n      case \"BLOCKQUOTE\":\n        node.readability.contentScore += 3;\n        break;\n\n      case \"ADDRESS\":\n      case \"OL\":\n      case \"UL\":\n      case \"DL\":\n      case \"DD\":\n      case \"DT\":\n      case \"LI\":\n      case \"FORM\":\n        node.readability.contentScore -= 3;\n        break;\n\n      case \"H1\":\n      case \"H2\":\n      case \"H3\":\n      case \"H4\":\n      case \"H5\":\n      case \"H6\":\n      case \"TH\":\n        node.readability.contentScore -= 5;\n        break;\n    }\n\n    node.readability.contentScore += this._getClassWeight(node);\n  },\n\n  _removeAndGetNext: function(node) {\n    var nextNode = this._getNextNode(node, true);\n    node.parentNode.removeChild(node);\n    return nextNode;\n  },\n\n  /**\n   * Traverse the DOM from node to node, starting at the node passed in.\n   * Pass true for the second parameter to indicate this node itself\n   * (and its kids) are going away, and we want the next node over.\n   *\n   * Calling this in a loop will traverse the DOM depth-first.\n   */\n  _getNextNode: function(node, ignoreSelfAndKids) {\n    // First check for kids if those aren't being ignored\n    if (!ignoreSelfAndKids && node.firstElementChild) {\n      return node.firstElementChild;\n    }\n    // Then for siblings...\n    if (node.nextElementSibling) {\n      return node.nextElementSibling;\n    }\n    // And finally, move up the parent chain *and* find a sibling\n    // (because this is depth-first traversal, we will have already\n    // seen the parent nodes themselves).\n    do {\n      node = node.parentNode;\n    } while (node && !node.nextElementSibling);\n    return node && node.nextElementSibling;\n  },\n\n  // compares second text to first one\n  // 1 = same text, 0 = completely different text\n  // works the way that it splits both texts into words and then finds words that are unique in second text\n  // the result is given by the lower length of unique parts\n  _textSimilarity: function(textA, textB) {\n    var tokensA = textA.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);\n    var tokensB = textB.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);\n    if (!tokensA.length || !tokensB.length) {\n      return 0;\n    }\n    var uniqTokensB = tokensB.filter(token => !tokensA.includes(token));\n    var distanceB = uniqTokensB.join(\" \").length / tokensB.join(\" \").length;\n    return 1 - distanceB;\n  },\n\n  _checkByline: function(node, matchString) {\n    if (this._articleByline) {\n      return false;\n    }\n\n    if (node.getAttribute !== undefined) {\n      var rel = node.getAttribute(\"rel\");\n      var itemprop = node.getAttribute(\"itemprop\");\n    }\n\n    if ((rel === \"author\" || (itemprop && itemprop.indexOf(\"author\") !== -1) || this.REGEXPS.byline.test(matchString)) && this._isValidByline(node.textContent)) {\n      this._articleByline = node.textContent.trim();\n      return true;\n    }\n\n    return false;\n  },\n\n  _getNodeAncestors: function(node, maxDepth) {\n    maxDepth = maxDepth || 0;\n    var i = 0, ancestors = [];\n    while (node.parentNode) {\n      ancestors.push(node.parentNode);\n      if (maxDepth && ++i === maxDepth)\n        break;\n      node = node.parentNode;\n    }\n    return ancestors;\n  },\n\n  /***\n   * grabArticle - Using a variety of metrics (content score, classname, element types), find the content that is\n   *         most likely to be the stuff a user wants to read. Then return it wrapped up in a div.\n   *\n   * @param page a document to run upon. Needs to be a full document, complete with body.\n   * @return Element\n  **/\n  _grabArticle: function (page) {\n    this.log(\"**** grabArticle ****\");\n    var doc = this._doc;\n    var isPaging = page !== null;\n    page = page ? page : this._doc.body;\n\n    // We can't grab an article if we don't have a page!\n    if (!page) {\n      this.log(\"No body found in document. Abort.\");\n      return null;\n    }\n\n    var pageCacheHtml = page.innerHTML;\n\n    while (true) {\n      this.log(\"Starting grabArticle loop\");\n      var stripUnlikelyCandidates = this._flagIsActive(this.FLAG_STRIP_UNLIKELYS);\n\n      // First, node prepping. Trash nodes that look cruddy (like ones with the\n      // class name \"comment\", etc), and turn divs into P tags where they have been\n      // used inappropriately (as in, where they contain no other block level elements.)\n      var elementsToScore = [];\n      var node = this._doc.documentElement;\n\n      let shouldRemoveTitleHeader = true;\n\n      while (node) {\n\n        if (node.tagName === \"HTML\") {\n          this._articleLang = node.getAttribute(\"lang\");\n        }\n\n        var matchString = node.className + \" \" + node.id;\n\n        if (!this._isProbablyVisible(node)) {\n          this.log(\"Removing hidden node - \" + matchString);\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        // Check to see if this node is a byline, and remove it if it is.\n        if (this._checkByline(node, matchString)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        if (shouldRemoveTitleHeader && this._headerDuplicatesTitle(node)) {\n          this.log(\"Removing header: \", node.textContent.trim(), this._articleTitle.trim());\n          shouldRemoveTitleHeader = false;\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        // Remove unlikely candidates\n        if (stripUnlikelyCandidates) {\n          if (this.REGEXPS.unlikelyCandidates.test(matchString) &&\n              !this.REGEXPS.okMaybeItsACandidate.test(matchString) &&\n              !this._hasAncestorTag(node, \"table\") &&\n              !this._hasAncestorTag(node, \"code\") &&\n              node.tagName !== \"BODY\" &&\n              node.tagName !== \"A\") {\n            this.log(\"Removing unlikely candidate - \" + matchString);\n            node = this._removeAndGetNext(node);\n            continue;\n          }\n\n          if (this.UNLIKELY_ROLES.includes(node.getAttribute(\"role\"))) {\n            this.log(\"Removing content with role \" + node.getAttribute(\"role\") + \" - \" + matchString);\n            node = this._removeAndGetNext(node);\n            continue;\n          }\n        }\n\n        // Remove DIV, SECTION, and HEADER nodes without any content(e.g. text, image, video, or iframe).\n        if ((node.tagName === \"DIV\" || node.tagName === \"SECTION\" || node.tagName === \"HEADER\" ||\n             node.tagName === \"H1\" || node.tagName === \"H2\" || node.tagName === \"H3\" ||\n             node.tagName === \"H4\" || node.tagName === \"H5\" || node.tagName === \"H6\") &&\n            this._isElementWithoutContent(node)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        if (this.DEFAULT_TAGS_TO_SCORE.indexOf(node.tagName) !== -1) {\n          elementsToScore.push(node);\n        }\n\n        // Turn all divs that don't have children block level elements into p's\n        if (node.tagName === \"DIV\") {\n          // Put phrasing content into paragraphs.\n          var p = null;\n          var childNode = node.firstChild;\n          while (childNode) {\n            var nextSibling = childNode.nextSibling;\n            if (this._isPhrasingContent(childNode)) {\n              if (p !== null) {\n                p.appendChild(childNode);\n              } else if (!this._isWhitespace(childNode)) {\n                p = doc.createElement(\"p\");\n                node.replaceChild(p, childNode);\n                p.appendChild(childNode);\n              }\n            } else if (p !== null) {\n              while (p.lastChild && this._isWhitespace(p.lastChild)) {\n                p.removeChild(p.lastChild);\n              }\n              p = null;\n            }\n            childNode = nextSibling;\n          }\n\n          // Sites like http://mobile.slate.com encloses each paragraph with a DIV\n          // element. DIVs with only a P element inside and no text content can be\n          // safely converted into plain P elements to avoid confusing the scoring\n          // algorithm with DIVs with are, in practice, paragraphs.\n          if (this._hasSingleTagInsideElement(node, \"P\") && this._getLinkDensity(node) < 0.25) {\n            var newNode = node.children[0];\n            node.parentNode.replaceChild(newNode, node);\n            node = newNode;\n            elementsToScore.push(node);\n          } else if (!this._hasChildBlockElement(node)) {\n            node = this._setNodeTag(node, \"P\");\n            elementsToScore.push(node);\n          }\n        }\n        node = this._getNextNode(node);\n      }\n\n      /**\n       * Loop through all paragraphs, and assign a score to them based on how content-y they look.\n       * Then add their score to their parent node.\n       *\n       * A score is determined by things like number of commas, class names, etc. Maybe eventually link density.\n      **/\n      var candidates = [];\n      this._forEachNode(elementsToScore, function(elementToScore) {\n        if (!elementToScore.parentNode || typeof(elementToScore.parentNode.tagName) === \"undefined\")\n          return;\n\n        // If this paragraph is less than 25 characters, don't even count it.\n        var innerText = this._getInnerText(elementToScore);\n        if (innerText.length < 25)\n          return;\n\n        // Exclude nodes with no ancestor.\n        var ancestors = this._getNodeAncestors(elementToScore, 5);\n        if (ancestors.length === 0)\n          return;\n\n        var contentScore = 0;\n\n        // Add a point for the paragraph itself as a base.\n        contentScore += 1;\n\n        // Add points for any commas within this paragraph.\n        contentScore += innerText.split(\",\").length;\n\n        // For every 100 characters in this paragraph, add another point. Up to 3 points.\n        contentScore += Math.min(Math.floor(innerText.length / 100), 3);\n\n        // Initialize and score ancestors.\n        this._forEachNode(ancestors, function(ancestor, level) {\n          if (!ancestor.tagName || !ancestor.parentNode || typeof(ancestor.parentNode.tagName) === \"undefined\")\n            return;\n\n          if (typeof(ancestor.readability) === \"undefined\") {\n            this._initializeNode(ancestor);\n            candidates.push(ancestor);\n          }\n\n          // Node score divider:\n          // - parent:             1 (no division)\n          // - grandparent:        2\n          // - great grandparent+: ancestor level * 3\n          if (level === 0)\n            var scoreDivider = 1;\n          else if (level === 1)\n            scoreDivider = 2;\n          else\n            scoreDivider = level * 3;\n          ancestor.readability.contentScore += contentScore / scoreDivider;\n        });\n      });\n\n      // After we've calculated scores, loop through all of the possible\n      // candidate nodes we found and find the one with the highest score.\n      var topCandidates = [];\n      for (var c = 0, cl = candidates.length; c < cl; c += 1) {\n        var candidate = candidates[c];\n\n        // Scale the final candidates score based on link density. Good content\n        // should have a relatively small link density (5% or less) and be mostly\n        // unaffected by this operation.\n        var candidateScore = candidate.readability.contentScore * (1 - this._getLinkDensity(candidate));\n        candidate.readability.contentScore = candidateScore;\n\n        this.log(\"Candidate:\", candidate, \"with score \" + candidateScore);\n\n        for (var t = 0; t < this._nbTopCandidates; t++) {\n          var aTopCandidate = topCandidates[t];\n\n          if (!aTopCandidate || candidateScore > aTopCandidate.readability.contentScore) {\n            topCandidates.splice(t, 0, candidate);\n            if (topCandidates.length > this._nbTopCandidates)\n              topCandidates.pop();\n            break;\n          }\n        }\n      }\n\n      var topCandidate = topCandidates[0] || null;\n      var neededToCreateTopCandidate = false;\n      var parentOfTopCandidate;\n\n      // If we still have no top candidate, just use the body as a last resort.\n      // We also have to copy the body node so it is something we can modify.\n      if (topCandidate === null || topCandidate.tagName === \"BODY\") {\n        // Move all of the page's children into topCandidate\n        topCandidate = doc.createElement(\"DIV\");\n        neededToCreateTopCandidate = true;\n        // Move everything (not just elements, also text nodes etc.) into the container\n        // so we even include text directly in the body:\n        while (page.firstChild) {\n          this.log(\"Moving child out:\", page.firstChild);\n          topCandidate.appendChild(page.firstChild);\n        }\n\n        page.appendChild(topCandidate);\n\n        this._initializeNode(topCandidate);\n      } else if (topCandidate) {\n        // Find a better top candidate node if it contains (at least three) nodes which belong to `topCandidates` array\n        // and whose scores are quite closed with current `topCandidate` node.\n        var alternativeCandidateAncestors = [];\n        for (var i = 1; i < topCandidates.length; i++) {\n          if (topCandidates[i].readability.contentScore / topCandidate.readability.contentScore >= 0.75) {\n            alternativeCandidateAncestors.push(this._getNodeAncestors(topCandidates[i]));\n          }\n        }\n        var MINIMUM_TOPCANDIDATES = 3;\n        if (alternativeCandidateAncestors.length >= MINIMUM_TOPCANDIDATES) {\n          parentOfTopCandidate = topCandidate.parentNode;\n          while (parentOfTopCandidate.tagName !== \"BODY\") {\n            var listsContainingThisAncestor = 0;\n            for (var ancestorIndex = 0; ancestorIndex < alternativeCandidateAncestors.length && listsContainingThisAncestor < MINIMUM_TOPCANDIDATES; ancestorIndex++) {\n              listsContainingThisAncestor += Number(alternativeCandidateAncestors[ancestorIndex].includes(parentOfTopCandidate));\n            }\n            if (listsContainingThisAncestor >= MINIMUM_TOPCANDIDATES) {\n              topCandidate = parentOfTopCandidate;\n              break;\n            }\n            parentOfTopCandidate = parentOfTopCandidate.parentNode;\n          }\n        }\n        if (!topCandidate.readability) {\n          this._initializeNode(topCandidate);\n        }\n\n        // Because of our bonus system, parents of candidates might have scores\n        // themselves. They get half of the node. There won't be nodes with higher\n        // scores than our topCandidate, but if we see the score going *up* in the first\n        // few steps up the tree, that's a decent sign that there might be more content\n        // lurking in other places that we want to unify in. The sibling stuff\n        // below does some of that - but only if we've looked high enough up the DOM\n        // tree.\n        parentOfTopCandidate = topCandidate.parentNode;\n        var lastScore = topCandidate.readability.contentScore;\n        // The scores shouldn't get too low.\n        var scoreThreshold = lastScore / 3;\n        while (parentOfTopCandidate.tagName !== \"BODY\") {\n          if (!parentOfTopCandidate.readability) {\n            parentOfTopCandidate = parentOfTopCandidate.parentNode;\n            continue;\n          }\n          var parentScore = parentOfTopCandidate.readability.contentScore;\n          if (parentScore < scoreThreshold)\n            break;\n          if (parentScore > lastScore) {\n            // Alright! We found a better parent to use.\n            topCandidate = parentOfTopCandidate;\n            break;\n          }\n          lastScore = parentOfTopCandidate.readability.contentScore;\n          parentOfTopCandidate = parentOfTopCandidate.parentNode;\n        }\n\n        // If the top candidate is the only child, use parent instead. This will help sibling\n        // joining logic when adjacent content is actually located in parent's sibling node.\n        parentOfTopCandidate = topCandidate.parentNode;\n        while (parentOfTopCandidate.tagName != \"BODY\" && parentOfTopCandidate.children.length == 1) {\n          topCandidate = parentOfTopCandidate;\n          parentOfTopCandidate = topCandidate.parentNode;\n        }\n        if (!topCandidate.readability) {\n          this._initializeNode(topCandidate);\n        }\n      }\n\n      // Now that we have the top candidate, look through its siblings for content\n      // that might also be related. Things like preambles, content split by ads\n      // that we removed, etc.\n      var articleContent = doc.createElement(\"DIV\");\n      if (isPaging)\n        articleContent.id = \"readability-content\";\n\n      var siblingScoreThreshold = Math.max(10, topCandidate.readability.contentScore * 0.2);\n      // Keep potential top candidate's parent node to try to get text direction of it later.\n      parentOfTopCandidate = topCandidate.parentNode;\n      var siblings = parentOfTopCandidate.children;\n\n      for (var s = 0, sl = siblings.length; s < sl; s++) {\n        var sibling = siblings[s];\n        var append = false;\n\n        this.log(\"Looking at sibling node:\", sibling, sibling.readability ? (\"with score \" + sibling.readability.contentScore) : \"\");\n        this.log(\"Sibling has score\", sibling.readability ? sibling.readability.contentScore : \"Unknown\");\n\n        if (sibling === topCandidate) {\n          append = true;\n        } else {\n          var contentBonus = 0;\n\n          // Give a bonus if sibling nodes and top candidates have the example same classname\n          if (sibling.className === topCandidate.className && topCandidate.className !== \"\")\n            contentBonus += topCandidate.readability.contentScore * 0.2;\n\n          if (sibling.readability &&\n              ((sibling.readability.contentScore + contentBonus) >= siblingScoreThreshold)) {\n            append = true;\n          } else if (sibling.nodeName === \"P\") {\n            var linkDensity = this._getLinkDensity(sibling);\n            var nodeContent = this._getInnerText(sibling);\n            var nodeLength = nodeContent.length;\n\n            if (nodeLength > 80 && linkDensity < 0.25) {\n              append = true;\n            } else if (nodeLength < 80 && nodeLength > 0 && linkDensity === 0 &&\n                       nodeContent.search(/\\.( |$)/) !== -1) {\n              append = true;\n            }\n          }\n        }\n\n        if (append) {\n          this.log(\"Appending node:\", sibling);\n\n          if (this.ALTER_TO_DIV_EXCEPTIONS.indexOf(sibling.nodeName) === -1) {\n            // We have a node that isn't a common block level element, like a form or td tag.\n            // Turn it into a div so it doesn't get filtered out later by accident.\n            this.log(\"Altering sibling:\", sibling, \"to div.\");\n\n            sibling = this._setNodeTag(sibling, \"DIV\");\n          }\n\n          articleContent.appendChild(sibling);\n          // Fetch children again to make it compatible\n          // with DOM parsers without live collection support.\n          siblings = parentOfTopCandidate.children;\n          // siblings is a reference to the children array, and\n          // sibling is removed from the array when we call appendChild().\n          // As a result, we must revisit this index since the nodes\n          // have been shifted.\n          s -= 1;\n          sl -= 1;\n        }\n      }\n\n      if (this._debug)\n        this.log(\"Article content pre-prep: \" + articleContent.innerHTML);\n      // So we have all of the content that we need. Now we clean it up for presentation.\n      this._prepArticle(articleContent);\n      if (this._debug)\n        this.log(\"Article content post-prep: \" + articleContent.innerHTML);\n\n      if (neededToCreateTopCandidate) {\n        // We already created a fake div thing, and there wouldn't have been any siblings left\n        // for the previous loop, so there's no point trying to create a new div, and then\n        // move all the children over. Just assign IDs and class names here. No need to append\n        // because that already happened anyway.\n        topCandidate.id = \"readability-page-1\";\n        topCandidate.className = \"page\";\n      } else {\n        var div = doc.createElement(\"DIV\");\n        div.id = \"readability-page-1\";\n        div.className = \"page\";\n        while (articleContent.firstChild) {\n          div.appendChild(articleContent.firstChild);\n        }\n        articleContent.appendChild(div);\n      }\n\n      if (this._debug)\n        this.log(\"Article content after paging: \" + articleContent.innerHTML);\n\n      var parseSuccessful = true;\n\n      // Now that we've gone through the full algorithm, check to see if\n      // we got any meaningful content. If we didn't, we may need to re-run\n      // grabArticle with different flags set. This gives us a higher likelihood of\n      // finding the content, and the sieve approach gives us a higher likelihood of\n      // finding the -right- content.\n      var textLength = this._getInnerText(articleContent, true).length;\n      if (textLength < this._charThreshold) {\n        parseSuccessful = false;\n        page.innerHTML = pageCacheHtml;\n\n        if (this._flagIsActive(this.FLAG_STRIP_UNLIKELYS)) {\n          this._removeFlag(this.FLAG_STRIP_UNLIKELYS);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else if (this._flagIsActive(this.FLAG_WEIGHT_CLASSES)) {\n          this._removeFlag(this.FLAG_WEIGHT_CLASSES);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else if (this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)) {\n          this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else {\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n          // No luck after removing flags, just return the longest text we found during the different loops\n          this._attempts.sort(function (a, b) {\n            return b.textLength - a.textLength;\n          });\n\n          // But first check if we actually have something\n          if (!this._attempts[0].textLength) {\n            return null;\n          }\n\n          articleContent = this._attempts[0].articleContent;\n          parseSuccessful = true;\n        }\n      }\n\n      if (parseSuccessful) {\n        // Find out text direction from ancestors of final top candidate.\n        var ancestors = [parentOfTopCandidate, topCandidate].concat(this._getNodeAncestors(parentOfTopCandidate));\n        this._someNode(ancestors, function(ancestor) {\n          if (!ancestor.tagName)\n            return false;\n          var articleDir = ancestor.getAttribute(\"dir\");\n          if (articleDir) {\n            this._articleDir = articleDir;\n            return true;\n          }\n          return false;\n        });\n        return articleContent;\n      }\n    }\n  },\n\n  /**\n   * Check whether the input string could be a byline.\n   * This verifies that the input is a string, and that the length\n   * is less than 100 chars.\n   *\n   * @param possibleByline {string} - a string to check whether its a byline.\n   * @return Boolean - whether the input string is a byline.\n   */\n  _isValidByline: function(byline) {\n    if (typeof byline == \"string\" || byline instanceof String) {\n      byline = byline.trim();\n      return (byline.length > 0) && (byline.length < 100);\n    }\n    return false;\n  },\n\n  /**\n   * Converts some of the common HTML entities in string to their corresponding characters.\n   *\n   * @param str {string} - a string to unescape.\n   * @return string without HTML entity.\n   */\n  _unescapeHtmlEntities: function(str) {\n    if (!str) {\n      return str;\n    }\n\n    var htmlEscapeMap = this.HTML_ESCAPE_MAP;\n    return str.replace(/&(quot|amp|apos|lt|gt);/g, function(_, tag) {\n      return htmlEscapeMap[tag];\n    }).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi, function(_, hex, numStr) {\n      var num = parseInt(hex || numStr, hex ? 16 : 10);\n      return String.fromCharCode(num);\n    });\n  },\n\n  /**\n   * Try to extract metadata from JSON-LD object.\n   * For now, only Schema.org objects of type Article or its subtypes are supported.\n   * @return Object with any metadata that could be extracted (possibly none)\n   */\n  _getJSONLD: function (doc) {\n    var scripts = this._getAllNodesWithTag(doc, [\"script\"]);\n\n    var metadata;\n\n    this._forEachNode(scripts, function(jsonLdElement) {\n      if (!metadata && jsonLdElement.getAttribute(\"type\") === \"application/ld+json\") {\n        try {\n          // Strip CDATA markers if present\n          var content = jsonLdElement.textContent.replace(/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g, \"\");\n          var parsed = JSON.parse(content);\n          if (\n            !parsed[\"@context\"] ||\n            !parsed[\"@context\"].match(/^https?\\:\\/\\/schema\\.org$/)\n          ) {\n            return;\n          }\n\n          if (!parsed[\"@type\"] && Array.isArray(parsed[\"@graph\"])) {\n            parsed = parsed[\"@graph\"].find(function(it) {\n              return (it[\"@type\"] || \"\").match(\n                this.REGEXPS.jsonLdArticleTypes\n              );\n            });\n          }\n\n          if (\n            !parsed ||\n            !parsed[\"@type\"] ||\n            !parsed[\"@type\"].match(this.REGEXPS.jsonLdArticleTypes)\n          ) {\n            return;\n          }\n\n          metadata = {};\n\n          if (typeof parsed.name === \"string\" && typeof parsed.headline === \"string\" && parsed.name !== parsed.headline) {\n            // we have both name and headline element in the JSON-LD. They should both be the same but some websites like aktualne.cz\n            // put their own name into \"name\" and the article title to \"headline\" which confuses Readability. So we try to check if either\n            // \"name\" or \"headline\" closely matches the html title, and if so, use that one. If not, then we use \"name\" by default.\n\n            var title = this._getArticleTitle();\n            var nameMatches = this._textSimilarity(parsed.name, title) > 0.75;\n            var headlineMatches = this._textSimilarity(parsed.headline, title) > 0.75;\n\n            if (headlineMatches && !nameMatches) {\n              metadata.title = parsed.headline;\n            } else {\n              metadata.title = parsed.name;\n            }\n          } else if (typeof parsed.name === \"string\") {\n            metadata.title = parsed.name.trim();\n          } else if (typeof parsed.headline === \"string\") {\n            metadata.title = parsed.headline.trim();\n          }\n          if (parsed.author) {\n            if (typeof parsed.author.name === \"string\") {\n              metadata.byline = parsed.author.name.trim();\n            } else if (Array.isArray(parsed.author) && parsed.author[0] && typeof parsed.author[0].name === \"string\") {\n              metadata.byline = parsed.author\n                .filter(function(author) {\n                  return author && typeof author.name === \"string\";\n                })\n                .map(function(author) {\n                  return author.name.trim();\n                })\n                .join(\", \");\n            }\n          }\n          if (typeof parsed.description === \"string\") {\n            metadata.excerpt = parsed.description.trim();\n          }\n          if (\n            parsed.publisher &&\n            typeof parsed.publisher.name === \"string\"\n          ) {\n            metadata.siteName = parsed.publisher.name.trim();\n          }\n          return;\n        } catch (err) {\n          this.log(err.message);\n        }\n      }\n    });\n    return metadata ? metadata : {};\n  },\n\n  /**\n   * Attempts to get excerpt and byline metadata for the article.\n   *\n   * @param {Object} jsonld  object containing any metadata that\n   * could be extracted from JSON-LD object.\n   *\n   * @return Object with optional \"excerpt\" and \"byline\" properties\n   */\n  _getArticleMetadata: function(jsonld) {\n    var metadata = {};\n    var values = {};\n    var metaElements = this._doc.getElementsByTagName(\"meta\");\n\n    // property is a space-separated list of values\n    var propertyPattern = /\\s*(dc|dcterm|og|twitter)\\s*:\\s*(author|creator|description|title|site_name)\\s*/gi;\n\n    // name is a single value\n    var namePattern = /^\\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\\s*[\\.:]\\s*)?(author|creator|description|title|site_name)\\s*$/i;\n\n    // Find description tags.\n    this._forEachNode(metaElements, function(element) {\n      var elementName = element.getAttribute(\"name\");\n      var elementProperty = element.getAttribute(\"property\");\n      var content = element.getAttribute(\"content\");\n      if (!content) {\n        return;\n      }\n      var matches = null;\n      var name = null;\n\n      if (elementProperty) {\n        matches = elementProperty.match(propertyPattern);\n        if (matches) {\n          // Convert to lowercase, and remove any whitespace\n          // so we can match below.\n          name = matches[0].toLowerCase().replace(/\\s/g, \"\");\n          // multiple authors\n          values[name] = content.trim();\n        }\n      }\n      if (!matches && elementName && namePattern.test(elementName)) {\n        name = elementName;\n        if (content) {\n          // Convert to lowercase, remove any whitespace, and convert dots\n          // to colons so we can match below.\n          name = name.toLowerCase().replace(/\\s/g, \"\").replace(/\\./g, \":\");\n          values[name] = content.trim();\n        }\n      }\n    });\n\n    // get title\n    metadata.title = jsonld.title ||\n                     values[\"dc:title\"] ||\n                     values[\"dcterm:title\"] ||\n                     values[\"og:title\"] ||\n                     values[\"weibo:article:title\"] ||\n                     values[\"weibo:webpage:title\"] ||\n                     values[\"title\"] ||\n                     values[\"twitter:title\"];\n\n    if (!metadata.title) {\n      metadata.title = this._getArticleTitle();\n    }\n\n    // get author\n    metadata.byline = jsonld.byline ||\n                      values[\"dc:creator\"] ||\n                      values[\"dcterm:creator\"] ||\n                      values[\"author\"];\n\n    // get description\n    metadata.excerpt = jsonld.excerpt ||\n                       values[\"dc:description\"] ||\n                       values[\"dcterm:description\"] ||\n                       values[\"og:description\"] ||\n                       values[\"weibo:article:description\"] ||\n                       values[\"weibo:webpage:description\"] ||\n                       values[\"description\"] ||\n                       values[\"twitter:description\"];\n\n    // get site name\n    metadata.siteName = jsonld.siteName ||\n                        values[\"og:site_name\"];\n\n    // in many sites the meta value is escaped with HTML entities,\n    // so here we need to unescape it\n    metadata.title = this._unescapeHtmlEntities(metadata.title);\n    metadata.byline = this._unescapeHtmlEntities(metadata.byline);\n    metadata.excerpt = this._unescapeHtmlEntities(metadata.excerpt);\n    metadata.siteName = this._unescapeHtmlEntities(metadata.siteName);\n\n    return metadata;\n  },\n\n  /**\n   * Check if node is image, or if node contains exactly only one image\n   * whether as a direct child or as its descendants.\n   *\n   * @param Element\n  **/\n  _isSingleImage: function(node) {\n    if (node.tagName === \"IMG\") {\n      return true;\n    }\n\n    if (node.children.length !== 1 || node.textContent.trim() !== \"\") {\n      return false;\n    }\n\n    return this._isSingleImage(node.children[0]);\n  },\n\n  /**\n   * Find all <noscript> that are located after <img> nodes, and which contain only one\n   * <img> element. Replace the first image with the image from inside the <noscript> tag,\n   * and remove the <noscript> tag. This improves the quality of the images we use on\n   * some sites (e.g. Medium).\n   *\n   * @param Element\n  **/\n  _unwrapNoscriptImages: function(doc) {\n    // Find img without source or attributes that might contains image, and remove it.\n    // This is done to prevent a placeholder img is replaced by img from noscript in next step.\n    var imgs = Array.from(doc.getElementsByTagName(\"img\"));\n    this._forEachNode(imgs, function(img) {\n      for (var i = 0; i < img.attributes.length; i++) {\n        var attr = img.attributes[i];\n        switch (attr.name) {\n          case \"src\":\n          case \"srcset\":\n          case \"data-src\":\n          case \"data-srcset\":\n            return;\n        }\n\n        if (/\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n          return;\n        }\n      }\n\n      img.parentNode.removeChild(img);\n    });\n\n    // Next find noscript and try to extract its image\n    var noscripts = Array.from(doc.getElementsByTagName(\"noscript\"));\n    this._forEachNode(noscripts, function(noscript) {\n      // Parse content of noscript and make sure it only contains image\n      var tmp = doc.createElement(\"div\");\n      tmp.innerHTML = noscript.innerHTML;\n      if (!this._isSingleImage(tmp)) {\n        return;\n      }\n\n      // If noscript has previous sibling and it only contains image,\n      // replace it with noscript content. However we also keep old\n      // attributes that might contains image.\n      var prevElement = noscript.previousElementSibling;\n      if (prevElement && this._isSingleImage(prevElement)) {\n        var prevImg = prevElement;\n        if (prevImg.tagName !== \"IMG\") {\n          prevImg = prevElement.getElementsByTagName(\"img\")[0];\n        }\n\n        var newImg = tmp.getElementsByTagName(\"img\")[0];\n        for (var i = 0; i < prevImg.attributes.length; i++) {\n          var attr = prevImg.attributes[i];\n          if (attr.value === \"\") {\n            continue;\n          }\n\n          if (attr.name === \"src\" || attr.name === \"srcset\" || /\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n            if (newImg.getAttribute(attr.name) === attr.value) {\n              continue;\n            }\n\n            var attrName = attr.name;\n            if (newImg.hasAttribute(attrName)) {\n              attrName = \"data-old-\" + attrName;\n            }\n\n            newImg.setAttribute(attrName, attr.value);\n          }\n        }\n\n        noscript.parentNode.replaceChild(tmp.firstElementChild, prevElement);\n      }\n    });\n  },\n\n  /**\n   * Removes script tags from the document.\n   *\n   * @param Element\n  **/\n  _removeScripts: function(doc) {\n    this._removeNodes(this._getAllNodesWithTag(doc, [\"script\"]), function(scriptNode) {\n      scriptNode.nodeValue = \"\";\n      scriptNode.removeAttribute(\"src\");\n      return true;\n    });\n    this._removeNodes(this._getAllNodesWithTag(doc, [\"noscript\"]));\n  },\n\n  /**\n   * Check if this node has only whitespace and a single element with given tag\n   * Returns false if the DIV node contains non-empty text nodes\n   * or if it contains no element with given tag or more than 1 element.\n   *\n   * @param Element\n   * @param string tag of child element\n  **/\n  _hasSingleTagInsideElement: function(element, tag) {\n    // There should be exactly 1 element child with given tag\n    if (element.children.length != 1 || element.children[0].tagName !== tag) {\n      return false;\n    }\n\n    // And there should be no text nodes with real content\n    return !this._someNode(element.childNodes, function(node) {\n      return node.nodeType === this.TEXT_NODE &&\n             this.REGEXPS.hasContent.test(node.textContent);\n    });\n  },\n\n  _isElementWithoutContent: function(node) {\n    return node.nodeType === this.ELEMENT_NODE &&\n      node.textContent.trim().length == 0 &&\n      (node.children.length == 0 ||\n       node.children.length == node.getElementsByTagName(\"br\").length + node.getElementsByTagName(\"hr\").length);\n  },\n\n  /**\n   * Determine whether element has any children block level elements.\n   *\n   * @param Element\n   */\n  _hasChildBlockElement: function (element) {\n    return this._someNode(element.childNodes, function(node) {\n      return this.DIV_TO_P_ELEMS.has(node.tagName) ||\n             this._hasChildBlockElement(node);\n    });\n  },\n\n  /***\n   * Determine if a node qualifies as phrasing content.\n   * https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories#Phrasing_content\n  **/\n  _isPhrasingContent: function(node) {\n    return node.nodeType === this.TEXT_NODE || this.PHRASING_ELEMS.indexOf(node.tagName) !== -1 ||\n      ((node.tagName === \"A\" || node.tagName === \"DEL\" || node.tagName === \"INS\") &&\n        this._everyNode(node.childNodes, this._isPhrasingContent));\n  },\n\n  _isWhitespace: function(node) {\n    return (node.nodeType === this.TEXT_NODE && node.textContent.trim().length === 0) ||\n           (node.nodeType === this.ELEMENT_NODE && node.tagName === \"BR\");\n  },\n\n  /**\n   * Get the inner text of a node - cross browser compatibly.\n   * This also strips out any excess whitespace to be found.\n   *\n   * @param Element\n   * @param Boolean normalizeSpaces (default: true)\n   * @return string\n  **/\n  _getInnerText: function(e, normalizeSpaces) {\n    normalizeSpaces = (typeof normalizeSpaces === \"undefined\") ? true : normalizeSpaces;\n    var textContent = e.textContent.trim();\n\n    if (normalizeSpaces) {\n      return textContent.replace(this.REGEXPS.normalize, \" \");\n    }\n    return textContent;\n  },\n\n  /**\n   * Get the number of times a string s appears in the node e.\n   *\n   * @param Element\n   * @param string - what to split on. Default is \",\"\n   * @return number (integer)\n  **/\n  _getCharCount: function(e, s) {\n    s = s || \",\";\n    return this._getInnerText(e).split(s).length - 1;\n  },\n\n  /**\n   * Remove the style attribute on every e and under.\n   * TODO: Test if getElementsByTagName(*) is faster.\n   *\n   * @param Element\n   * @return void\n  **/\n  _cleanStyles: function(e) {\n    if (!e || e.tagName.toLowerCase() === \"svg\")\n      return;\n\n    // Remove `style` and deprecated presentational attributes\n    for (var i = 0; i < this.PRESENTATIONAL_ATTRIBUTES.length; i++) {\n      e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[i]);\n    }\n\n    if (this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(e.tagName) !== -1) {\n      e.removeAttribute(\"width\");\n      e.removeAttribute(\"height\");\n    }\n\n    var cur = e.firstElementChild;\n    while (cur !== null) {\n      this._cleanStyles(cur);\n      cur = cur.nextElementSibling;\n    }\n  },\n\n  /**\n   * Get the density of links as a percentage of the content\n   * This is the amount of text that is inside a link divided by the total text in the node.\n   *\n   * @param Element\n   * @return number (float)\n  **/\n  _getLinkDensity: function(element) {\n    var textLength = this._getInnerText(element).length;\n    if (textLength === 0)\n      return 0;\n\n    var linkLength = 0;\n\n    // XXX implement _reduceNodeList?\n    this._forEachNode(element.getElementsByTagName(\"a\"), function(linkNode) {\n      var href = linkNode.getAttribute(\"href\");\n      var coefficient = href && this.REGEXPS.hashUrl.test(href) ? 0.3 : 1;\n      linkLength += this._getInnerText(linkNode).length * coefficient;\n    });\n\n    return linkLength / textLength;\n  },\n\n  /**\n   * Get an elements class/id weight. Uses regular expressions to tell if this\n   * element looks good or bad.\n   *\n   * @param Element\n   * @return number (Integer)\n  **/\n  _getClassWeight: function(e) {\n    if (!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))\n      return 0;\n\n    var weight = 0;\n\n    // Look for a special classname\n    if (typeof(e.className) === \"string\" && e.className !== \"\") {\n      if (this.REGEXPS.negative.test(e.className))\n        weight -= 25;\n\n      if (this.REGEXPS.positive.test(e.className))\n        weight += 25;\n    }\n\n    // Look for a special ID\n    if (typeof(e.id) === \"string\" && e.id !== \"\") {\n      if (this.REGEXPS.negative.test(e.id))\n        weight -= 25;\n\n      if (this.REGEXPS.positive.test(e.id))\n        weight += 25;\n    }\n\n    return weight;\n  },\n\n  /**\n   * Clean a node of all elements of type \"tag\".\n   * (Unless it's a youtube/vimeo video. People love movies.)\n   *\n   * @param Element\n   * @param string tag to clean\n   * @return void\n   **/\n  _clean: function(e, tag) {\n    var isEmbed = [\"object\", \"embed\", \"iframe\"].indexOf(tag) !== -1;\n\n    this._removeNodes(this._getAllNodesWithTag(e, [tag]), function(element) {\n      // Allow youtube and vimeo videos through as people usually want to see those.\n      if (isEmbed) {\n        // First, check the elements attributes to see if any of them contain youtube or vimeo\n        for (var i = 0; i < element.attributes.length; i++) {\n          if (this.REGEXPS.videos.test(element.attributes[i].value)) {\n            return false;\n          }\n        }\n\n        // For embed with <object> tag, check inner HTML as well.\n        if (element.tagName === \"object\" && this.REGEXPS.videos.test(element.innerHTML)) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  },\n\n  /**\n   * Check if a given node has one of its ancestor tag name matching the\n   * provided one.\n   * @param  HTMLElement node\n   * @param  String      tagName\n   * @param  Number      maxDepth\n   * @param  Function    filterFn a filter to invoke to determine whether this node 'counts'\n   * @return Boolean\n   */\n  _hasAncestorTag: function(node, tagName, maxDepth, filterFn) {\n    maxDepth = maxDepth || 3;\n    tagName = tagName.toUpperCase();\n    var depth = 0;\n    while (node.parentNode) {\n      if (maxDepth > 0 && depth > maxDepth)\n        return false;\n      if (node.parentNode.tagName === tagName && (!filterFn || filterFn(node.parentNode)))\n        return true;\n      node = node.parentNode;\n      depth++;\n    }\n    return false;\n  },\n\n  /**\n   * Return an object indicating how many rows and columns this table has.\n   */\n  _getRowAndColumnCount: function(table) {\n    var rows = 0;\n    var columns = 0;\n    var trs = table.getElementsByTagName(\"tr\");\n    for (var i = 0; i < trs.length; i++) {\n      var rowspan = trs[i].getAttribute(\"rowspan\") || 0;\n      if (rowspan) {\n        rowspan = parseInt(rowspan, 10);\n      }\n      rows += (rowspan || 1);\n\n      // Now look for column-related info\n      var columnsInThisRow = 0;\n      var cells = trs[i].getElementsByTagName(\"td\");\n      for (var j = 0; j < cells.length; j++) {\n        var colspan = cells[j].getAttribute(\"colspan\") || 0;\n        if (colspan) {\n          colspan = parseInt(colspan, 10);\n        }\n        columnsInThisRow += (colspan || 1);\n      }\n      columns = Math.max(columns, columnsInThisRow);\n    }\n    return {rows: rows, columns: columns};\n  },\n\n  /**\n   * Look for 'data' (as opposed to 'layout') tables, for which we use\n   * similar checks as\n   * https://searchfox.org/mozilla-central/rev/f82d5c549f046cb64ce5602bfd894b7ae807c8f8/accessible/generic/TableAccessible.cpp#19\n   */\n  _markDataTables: function(root) {\n    var tables = root.getElementsByTagName(\"table\");\n    for (var i = 0; i < tables.length; i++) {\n      var table = tables[i];\n      var role = table.getAttribute(\"role\");\n      if (role == \"presentation\") {\n        table._readabilityDataTable = false;\n        continue;\n      }\n      var datatable = table.getAttribute(\"datatable\");\n      if (datatable == \"0\") {\n        table._readabilityDataTable = false;\n        continue;\n      }\n      var summary = table.getAttribute(\"summary\");\n      if (summary) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      var caption = table.getElementsByTagName(\"caption\")[0];\n      if (caption && caption.childNodes.length > 0) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      // If the table has a descendant with any of these tags, consider a data table:\n      var dataTableDescendants = [\"col\", \"colgroup\", \"tfoot\", \"thead\", \"th\"];\n      var descendantExists = function(tag) {\n        return !!table.getElementsByTagName(tag)[0];\n      };\n      if (dataTableDescendants.some(descendantExists)) {\n        this.log(\"Data table because found data-y descendant\");\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      // Nested tables indicate a layout table:\n      if (table.getElementsByTagName(\"table\")[0]) {\n        table._readabilityDataTable = false;\n        continue;\n      }\n\n      var sizeInfo = this._getRowAndColumnCount(table);\n      if (sizeInfo.rows >= 10 || sizeInfo.columns > 4) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n      // Now just go by size entirely:\n      table._readabilityDataTable = sizeInfo.rows * sizeInfo.columns > 10;\n    }\n  },\n\n  /* convert images and figures that have properties like data-src into images that can be loaded without JS */\n  _fixLazyImages: function (root) {\n    this._forEachNode(this._getAllNodesWithTag(root, [\"img\", \"picture\", \"figure\"]), function (elem) {\n      // In some sites (e.g. Kotaku), they put 1px square image as base64 data uri in the src attribute.\n      // So, here we check if the data uri is too short, just might as well remove it.\n      if (elem.src && this.REGEXPS.b64DataUrl.test(elem.src)) {\n        // Make sure it's not SVG, because SVG can have a meaningful image in under 133 bytes.\n        var parts = this.REGEXPS.b64DataUrl.exec(elem.src);\n        if (parts[1] === \"image/svg+xml\") {\n          return;\n        }\n\n        // Make sure this element has other attributes which contains image.\n        // If it doesn't, then this src is important and shouldn't be removed.\n        var srcCouldBeRemoved = false;\n        for (var i = 0; i < elem.attributes.length; i++) {\n          var attr = elem.attributes[i];\n          if (attr.name === \"src\") {\n            continue;\n          }\n\n          if (/\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n            srcCouldBeRemoved = true;\n            break;\n          }\n        }\n\n        // Here we assume if image is less than 100 bytes (or 133B after encoded to base64)\n        // it will be too small, therefore it might be placeholder image.\n        if (srcCouldBeRemoved) {\n          var b64starts = elem.src.search(/base64\\s*/i) + 7;\n          var b64length = elem.src.length - b64starts;\n          if (b64length < 133) {\n            elem.removeAttribute(\"src\");\n          }\n        }\n      }\n\n      // also check for \"null\" to work around https://github.com/jsdom/jsdom/issues/2580\n      if ((elem.src || (elem.srcset && elem.srcset != \"null\")) && elem.className.toLowerCase().indexOf(\"lazy\") === -1) {\n        return;\n      }\n\n      for (var j = 0; j < elem.attributes.length; j++) {\n        attr = elem.attributes[j];\n        if (attr.name === \"src\" || attr.name === \"srcset\" || attr.name === \"alt\") {\n          continue;\n        }\n        var copyTo = null;\n        if (/\\.(jpg|jpeg|png|webp)\\s+\\d/.test(attr.value)) {\n          copyTo = \"srcset\";\n        } else if (/^\\s*\\S+\\.(jpg|jpeg|png|webp)\\S*\\s*$/.test(attr.value)) {\n          copyTo = \"src\";\n        }\n        if (copyTo) {\n          //if this is an img or picture, set the attribute directly\n          if (elem.tagName === \"IMG\" || elem.tagName === \"PICTURE\") {\n            elem.setAttribute(copyTo, attr.value);\n          } else if (elem.tagName === \"FIGURE\" && !this._getAllNodesWithTag(elem, [\"img\", \"picture\"]).length) {\n            //if the item is a <figure> that does not contain an image or picture, create one and place it inside the figure\n            //see the nytimes-3 testcase for an example\n            var img = this._doc.createElement(\"img\");\n            img.setAttribute(copyTo, attr.value);\n            elem.appendChild(img);\n          }\n        }\n      }\n    });\n  },\n\n  _getTextDensity: function(e, tags) {\n    var textLength = this._getInnerText(e, true).length;\n    if (textLength === 0) {\n      return 0;\n    }\n    var childrenLength = 0;\n    var children = this._getAllNodesWithTag(e, tags);\n    this._forEachNode(children, (child) => childrenLength += this._getInnerText(child, true).length);\n    return childrenLength / textLength;\n  },\n\n  /**\n   * Clean an element of all tags of type \"tag\" if they look fishy.\n   * \"Fishy\" is an algorithm based on content length, classnames, link density, number of images & embeds, etc.\n   *\n   * @return void\n   **/\n  _cleanConditionally: function(e, tag) {\n    if (!this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))\n      return;\n\n    // Gather counts for other typical elements embedded within.\n    // Traverse backwards so we can remove nodes at the same time\n    // without effecting the traversal.\n    //\n    // TODO: Consider taking into account original contentScore here.\n    this._removeNodes(this._getAllNodesWithTag(e, [tag]), function(node) {\n      // First check if this node IS data table, in which case don't remove it.\n      var isDataTable = function(t) {\n        return t._readabilityDataTable;\n      };\n\n      var isList = tag === \"ul\" || tag === \"ol\";\n      if (!isList) {\n        var listLength = 0;\n        var listNodes = this._getAllNodesWithTag(node, [\"ul\", \"ol\"]);\n        this._forEachNode(listNodes, (list) => listLength += this._getInnerText(list).length);\n        isList = listLength / this._getInnerText(node).length > 0.9;\n      }\n\n      if (tag === \"table\" && isDataTable(node)) {\n        return false;\n      }\n\n      // Next check if we're inside a data table, in which case don't remove it as well.\n      if (this._hasAncestorTag(node, \"table\", -1, isDataTable)) {\n        return false;\n      }\n\n      if (this._hasAncestorTag(node, \"code\")) {\n        return false;\n      }\n\n      var weight = this._getClassWeight(node);\n\n      this.log(\"Cleaning Conditionally\", node);\n\n      var contentScore = 0;\n\n      if (weight + contentScore < 0) {\n        return true;\n      }\n\n      if (this._getCharCount(node, \",\") < 10) {\n        // If there are not very many commas, and the number of\n        // non-paragraph elements is more than paragraphs or other\n        // ominous signs, remove the element.\n        var p = node.getElementsByTagName(\"p\").length;\n        var img = node.getElementsByTagName(\"img\").length;\n        var li = node.getElementsByTagName(\"li\").length - 100;\n        var input = node.getElementsByTagName(\"input\").length;\n        var headingDensity = this._getTextDensity(node, [\"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"]);\n\n        var embedCount = 0;\n        var embeds = this._getAllNodesWithTag(node, [\"object\", \"embed\", \"iframe\"]);\n\n        for (var i = 0; i < embeds.length; i++) {\n          // If this embed has attribute that matches video regex, don't delete it.\n          for (var j = 0; j < embeds[i].attributes.length; j++) {\n            if (this.REGEXPS.videos.test(embeds[i].attributes[j].value)) {\n              return false;\n            }\n          }\n\n          // For embed with <object> tag, check inner HTML as well.\n          if (embeds[i].tagName === \"object\" && this.REGEXPS.videos.test(embeds[i].innerHTML)) {\n            return false;\n          }\n\n          embedCount++;\n        }\n\n        var linkDensity = this._getLinkDensity(node);\n        var contentLength = this._getInnerText(node).length;\n\n        var haveToRemove =\n          (img > 1 && p / img < 0.5 && !this._hasAncestorTag(node, \"figure\")) ||\n          (!isList && li > p) ||\n          (input > Math.floor(p/3)) ||\n          (!isList && headingDensity < 0.9 && contentLength < 25 && (img === 0 || img > 2) && !this._hasAncestorTag(node, \"figure\")) ||\n          (!isList && weight < 25 && linkDensity > 0.2) ||\n          (weight >= 25 && linkDensity > 0.5) ||\n          ((embedCount === 1 && contentLength < 75) || embedCount > 1);\n        return haveToRemove;\n      }\n      return false;\n    });\n  },\n\n  /**\n   * Clean out elements that match the specified conditions\n   *\n   * @param Element\n   * @param Function determines whether a node should be removed\n   * @return void\n   **/\n  _cleanMatchedNodes: function(e, filter) {\n    var endOfSearchMarkerNode = this._getNextNode(e, true);\n    var next = this._getNextNode(e);\n    while (next && next != endOfSearchMarkerNode) {\n      if (filter.call(this, next, next.className + \" \" + next.id)) {\n        next = this._removeAndGetNext(next);\n      } else {\n        next = this._getNextNode(next);\n      }\n    }\n  },\n\n  /**\n   * Clean out spurious headers from an Element.\n   *\n   * @param Element\n   * @return void\n  **/\n  _cleanHeaders: function(e) {\n    let headingNodes = this._getAllNodesWithTag(e, [\"h1\", \"h2\"]);\n    this._removeNodes(headingNodes, function(node) {\n      let shouldRemove = this._getClassWeight(node) < 0;\n      if (shouldRemove) {\n        this.log(\"Removing header with low class weight:\", node);\n      }\n      return shouldRemove;\n    });\n  },\n\n  /**\n   * Check if this node is an H1 or H2 element whose content is mostly\n   * the same as the article title.\n   *\n   * @param Element  the node to check.\n   * @return boolean indicating whether this is a title-like header.\n   */\n  _headerDuplicatesTitle: function(node) {\n    if (node.tagName != \"H1\" && node.tagName != \"H2\") {\n      return false;\n    }\n    var heading = this._getInnerText(node, false);\n    this.log(\"Evaluating similarity of header:\", heading, this._articleTitle);\n    return this._textSimilarity(this._articleTitle, heading) > 0.75;\n  },\n\n  _flagIsActive: function(flag) {\n    return (this._flags & flag) > 0;\n  },\n\n  _removeFlag: function(flag) {\n    this._flags = this._flags & ~flag;\n  },\n\n  _isProbablyVisible: function(node) {\n    // Have to null-check node.style and node.className.indexOf to deal with SVG and MathML nodes.\n    return (!node.style || node.style.display != \"none\")\n      && !node.hasAttribute(\"hidden\")\n      //check for \"fallback-image\" so that wikimedia math images are displayed\n      && (!node.hasAttribute(\"aria-hidden\") || node.getAttribute(\"aria-hidden\") != \"true\" || (node.className && node.className.indexOf && node.className.indexOf(\"fallback-image\") !== -1));\n  },\n\n  /**\n   * Runs readability.\n   *\n   * Workflow:\n   *  1. Prep the document by removing script tags, css, etc.\n   *  2. Build readability's DOM tree.\n   *  3. Grab the article content from the current dom tree.\n   *  4. Replace the current DOM tree with the new one.\n   *  5. Read peacefully.\n   *\n   * @return void\n   **/\n  parse: function () {\n    // Avoid parsing too large documents, as per configuration option\n    if (this._maxElemsToParse > 0) {\n      var numTags = this._doc.getElementsByTagName(\"*\").length;\n      if (numTags > this._maxElemsToParse) {\n        throw new Error(\"Aborting parsing document; \" + numTags + \" elements found\");\n      }\n    }\n\n    // Unwrap image from noscript\n    this._unwrapNoscriptImages(this._doc);\n\n    // Extract JSON-LD metadata before removing scripts\n    var jsonLd = this._disableJSONLD ? {} : this._getJSONLD(this._doc);\n\n    // Remove script tags from the document.\n    this._removeScripts(this._doc);\n\n    this._prepDocument();\n\n    var metadata = this._getArticleMetadata(jsonLd);\n    this._articleTitle = metadata.title;\n\n    var articleContent = this._grabArticle();\n    if (!articleContent)\n      return null;\n\n    this.log(\"Grabbed: \" + articleContent.innerHTML);\n\n    this._postProcessContent(articleContent);\n\n    // If we haven't found an excerpt in the article's metadata, use the article's\n    // first paragraph as the excerpt. This is used for displaying a preview of\n    // the article's content.\n    if (!metadata.excerpt) {\n      var paragraphs = articleContent.getElementsByTagName(\"p\");\n      if (paragraphs.length > 0) {\n        metadata.excerpt = paragraphs[0].textContent.trim();\n      }\n    }\n\n    var textContent = articleContent.textContent;\n    return {\n      title: this._articleTitle,\n      byline: metadata.byline || this._articleByline,\n      dir: this._articleDir,\n      lang: this._articleLang,\n      content: this._serializer(articleContent),\n      textContent: textContent,\n      length: textContent.length,\n      excerpt: metadata.excerpt,\n      siteName: metadata.siteName || this._articleSiteName\n    };\n  }\n};\n\nif (typeof module === \"object\") {\n  module.exports = Readability;\n}\n","var Readability = require(\"./Readability\");\nvar isProbablyReaderable = require(\"./Readability-readerable\");\n\nmodule.exports = {\n  Readability: Readability,\n  isProbablyReaderable: isProbablyReaderable\n};\n","import app from 'flarum/common/app';\n\napp.initializers.add('tudor/read-mode', () => {\n  console.log('[tudor/read-mode] Hello, forum and admin!');\n});\n","import Modal from \"flarum/components/Modal\";\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport PostLoading from 'flarum/components/LoadingPost';\r\nimport SplitDropdown from 'flarum/common/components/SplitDropdown';\r\nimport Button from 'flarum/common/components/Button';\r\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\r\nimport listItems from 'flarum/common/helpers/listItems';\r\nimport PostControls from 'flarum/utils/PostControls';\r\nimport PostUser from 'flarum/components/PostUser';\r\nimport PostMeta from 'flarum/components/PostMeta';\r\nimport PostEdited from 'flarum/components/PostEdited';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Separator from 'flarum/common/components/Separator';\r\n\r\nexport default class ArticleModal extends Modal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.discussion = this.attrs.discussion;\r\n\r\n    this.includedPosts = [];\r\n\r\n    this.firstPostControls = [];\r\n\r\n    this.headerItemsFirstComment = '';\r\n\r\n    \r\n\r\n    // app.history.push('discussion');\r\n    // console.log(app);\r\n    // console.log(this);\r\n    var docElm = document.documentElement;\r\n    if (docElm.requestFullscreen) {\r\n      docElm.requestFullscreen();\r\n    } else if (docElm.msRequestFullscreen) {\r\n      docElm.msRequestFullscreen();\r\n    } else if (docElm.mozRequestFullScreen) {\r\n      docElm.mozRequestFullScreen();\r\n    } else if (docElm.webkitRequestFullScreen) {\r\n      docElm.webkitRequestFullScreen();\r\n    }\r\n  }\r\n\r\n  className() {\r\n    return \"ReadModeModal Modal--full\";\r\n  }\r\n\r\n  title() {\r\n    return \"\";\r\n    // return this.discussion.title();\r\n  }\r\n\r\n  content() {\r\n\r\n    const params = this.requestParams();\r\n    app.store.find('discussions', this.discussion.id(), params)\r\n      .then((discussion) => {\r\n        // console.log(discussion);\r\n        if (discussion.payload && discussion.payload.included) {\r\n          let includedPosts = [];\r\n          const discussionId = discussion.id();\r\n    \r\n          includedPosts = discussion.payload.included\r\n            .filter(\r\n              (record) =>\r\n                record.type === 'posts' &&\r\n                record.relationships &&\r\n                record.relationships.discussion &&\r\n                record.relationships.discussion.data.id === discussionId\r\n            )\r\n            .map((record) => app.store.getById('posts', record.id))\r\n            .sort((a, b) => a.createdAt() - b.createdAt())\r\n            .slice(0, 20);\r\n\r\n          // return includedPosts;\r\n          this.setPosts(includedPosts);\r\n        }\r\n      });\r\n      \r\n    let lastTime;\r\n    const postIds = this.discussion.postIds();\r\n\r\n    const items = this.includedPosts.map((post, i) => {\r\n      let content;\r\n      const attrs = { 'data-index': i };\r\n\r\n      // console.log(attrs);\r\n      if (post) {\r\n        const time = post.createdAt();\r\n        const PostComponent = app.postComponents[post.contentType()];\r\n        content = PostComponent ? PostComponent.component({ post }) : '';\r\n        \r\n        if (post.number() == 1) {\r\n          this.firstPostControls = PostControls.controls(post, this).toArray();\r\n          const items = new ItemList();\r\n          \r\n\r\n          items.add(\r\n            'meta',\r\n            PostMeta.component({ post }),\r\n          );\r\n\r\n          if (post.isEdited() && !post.isHidden()) {\r\n            items.add('edited', PostEdited.component({ post }));\r\n          }\r\n\r\n          this.headerItemsFirstComment = items.toArray();\r\n          // console.log(content.dom);\r\n          // m.redraw();\r\n        }\r\n\r\n        attrs.key = 'post' + post.id();\r\n        attrs['data-time'] = time.toISOString();\r\n        attrs['data-number'] = post.number();\r\n        attrs['data-id'] = post.id();\r\n        attrs['data-type'] = post.contentType();\r\n\r\n        // If the post before this one was more than 4 days ago, we will\r\n        // display a 'time gap' indicating how long it has been in between\r\n        // the posts.\r\n        const dt = time - lastTime;\r\n\r\n        if (dt > 1000 * 60 * 60 * 24 * 4) {\r\n          content = [\r\n            <div className=\"PostStream-timeGap\">\r\n              <span>{app.translator.trans('core.forum.post_stream.time_lapsed_text', { period: dayjs().add(dt, 'ms').fromNow(true) })}</span>\r\n            </div>,\r\n            content,\r\n          ];\r\n        }\r\n\r\n        lastTime = time;\r\n      } else {\r\n        attrs.key = 'post' + postIds[i];\r\n\r\n        content = PostLoading.component();\r\n      }\r\n\r\n      return (\r\n        <div className=\"ReadModePostStream-item \" {...attrs}>\r\n          {content}\r\n        </div>\r\n      );\r\n    });\r\n\r\n    // console.log(items);\r\n    // console.log(this.headerItemsFirstComment);\r\n\r\n    return [\r\n      items.length !== 0 ? [\r\n        <div className=\"DiscussionPage-stream ReadMode\">\r\n          <div className=\"Modal-header ArticleTitle\">\r\n            <h3 className=\"App-titleControl App-titleControl--text\">{this.discussion.title()}</h3>\r\n          </div>\r\n            <div className=\"PostStream\">{items[0]}</div>\r\n        </div>\r\n      ] : (\r\n        <LoadingIndicator size='large' />\r\n      )\r\n    ]\r\n  }\r\n\r\n  setPosts(posts) {\r\n    // console.log(posts);\r\n    this.includedPosts = posts;\r\n    m.redraw();\r\n  }\r\n\r\n  /**\r\n   * Get the parameters that should be passed in the API request to get the\r\n   * discussion.\r\n   *\r\n   * @return {Object}\r\n   */\r\n   requestParams() {\r\n    return {\r\n      bySlug: true,\r\n      page: { near: this.near },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Build an item list for the contents of the sidebar.\r\n   *\r\n   * @return {ItemList}\r\n   */\r\n   articleItems() {\r\n    const items = new ItemList();\r\n\r\n    return items;\r\n  }\r\n\r\n  /**\r\n   * Build an item list for the contents of the sidebar.\r\n   *\r\n   * @return {ItemList}\r\n   */\r\n   commentItems() {\r\n    const items = new ItemList();\r\n    return items;\r\n  }\r\n\r\n  hide(){\r\n    if (document.fullscreenElement) {\r\n        document.exitFullscreen()\r\n          .then(() => console.log(\"Document Exited from Full screen mode\"))\r\n          .catch((err) => console.error(err))\r\n      } else {\r\n        document.documentElement.requestFullscreen();\r\n      }\r\n    this.attrs.state.close();\r\n  }\r\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport Button from 'flarum/common/components/Button';\nimport Model from 'flarum/common/Model';\nimport Discussion from 'flarum/common/models/Discussion';\n\n// import ReadModeModal from './components/ReadModeModal';\nimport ArticleModal from './components/ArticleModal';\nimport { getBrowser } from './utils/getBrowser';\nimport { isProbablyReaderable, Readability } from '@mozilla/readability'\n\napp.initializers.add('tudor/read-mode', () => {\n\n  // Discussion.prototype.shareUrl = Model.attribute('shareUrl');\n  extend(DiscussionPage.prototype, 'sidebarItems', function (items) {\n    const browser = getBrowser();\n\n    console.log(browser);\n    // fnBrowserDetect();\n\n    const handleBrowser = () => {\n      if (browser === 'firefox') {\n        if (isProbablyReaderable(document)) {\n          const documentClone = document.cloneNode(true);\n          const article = new Readability(documentClone).parse();\n          // TODO\n          app.modal.show(ArticleModal, { discussion: this.discussion });\n        }\n      }\n      if (browser === 'edge') {\n        const baseUrl = app.forum.attribute('baseUrl');\n        const read_url = `read://https_${baseUrl}?url=${this.discussion.shareUrl()}`;\n        window.open(read_url, \"_blank\");\n        // console.log(read_url);\n      }\n      else {\n        app.modal.show(ArticleModal, { discussion: this.discussion });\n      }\n\n\n    }\n\n    items.add('read-mode',\n      <Button\n        class=\"Button Button-icon Button--read-mode\"\n        icon=\"fas fa-book-reader\"\n        onclick={() => handleBrowser()}\n      >\n        {app.translator.trans('read-mode.forum.discussion.read_mode_button')}\n      </Button>,\n      -1\n    );\n  });\n\n});\n","export function getBrowser() {\n  let userAgent = navigator.userAgent;\n  let browserName;\n\n  if (userAgent.match(/chrome|chromium|crios/i)) {\n    browserName = 'chrome';\n    if (userAgent.indexOf(\"Edg\") > -1){\n      browserName = 'edge';\n    }\n  } else if (userAgent.match(/firefox|fxios/i)) {\n    browserName = 'firefox';\n  } else if (userAgent.match(/safari/i)) {\n    browserName = 'safari';\n  } else if (userAgent.match(/opr\\//i)) {\n    browserName = 'opera';\n  } else if (userAgent.match(/edg/i)) {\n    browserName = 'edge';\n  } else {\n    browserName = 'No browser detection';\n  }\n\n  return browserName;\n}\n","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Separator'];","module.exports = flarum.core.compat['common/components/SplitDropdown'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/listItems'];","module.exports = flarum.core.compat['common/models/Discussion'];","module.exports = flarum.core.compat['components/LoadingPost'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/PostEdited'];","module.exports = flarum.core.compat['components/PostMeta'];","module.exports = flarum.core.compat['components/PostUser'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['utils/ItemList'];","module.exports = flarum.core.compat['utils/PostControls'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/common';\nexport * from './src/forum';\n"],"names":["REGEXPS","unlikelyCandidates","okMaybeItsACandidate","isNodeVisible","node","style","display","hasAttribute","getAttribute","className","indexOf","isProbablyReaderable","doc","options","visibilityChecker","defaultOptions","minScore","minContentLength","Object","assign","nodes","querySelectorAll","brNodes","length","set","Set","forEach","call","add","parentNode","Array","from","score","some","matchString","id","test","matches","textContentLength","textContent","trim","Math","sqrt","module","exports","Readability","documentElement","arguments","Error","_doc","_docJSDOMParser","firstChild","__JSDOMParser__","_articleTitle","_articleByline","_articleDir","_articleSiteName","_attempts","_debug","debug","_maxElemsToParse","maxElemsToParse","DEFAULT_MAX_ELEMS_TO_PARSE","_nbTopCandidates","nbTopCandidates","DEFAULT_N_TOP_CANDIDATES","_charThreshold","charThreshold","DEFAULT_CHAR_THRESHOLD","_classesToPreserve","CLASSES_TO_PRESERVE","concat","classesToPreserve","_keepClasses","keepClasses","_serializer","serializer","el","innerHTML","_disableJSONLD","disableJSONLD","_flags","FLAG_STRIP_UNLIKELYS","FLAG_WEIGHT_CLASSES","FLAG_CLEAN_CONDITIONALLY","logNode","nodeType","TEXT_NODE","nodeName","attrPairs","attributes","attr","name","value","join","localName","log","dump","msg","prototype","map","x","console","args","arg","ELEMENT_NODE","unshift","apply","DEFAULT_TAGS_TO_SCORE","toUpperCase","split","positive","negative","extraneous","byline","replaceFonts","normalize","videos","shareElements","nextLink","prevLink","tokenize","whitespace","hasContent","hashUrl","srcsetUrl","b64DataUrl","jsonLdArticleTypes","UNLIKELY_ROLES","DIV_TO_P_ELEMS","ALTER_TO_DIV_EXCEPTIONS","PRESENTATIONAL_ATTRIBUTES","DEPRECATED_SIZE_ATTRIBUTE_ELEMS","PHRASING_ELEMS","HTML_ESCAPE_MAP","_postProcessContent","articleContent","_fixRelativeUris","_simplifyNestedElements","_cleanClasses","_removeNodes","nodeList","filterFn","_isLiveNodeList","i","removeChild","_replaceNodeTags","newTagName","_setNodeTag","_forEachNode","fn","_findNode","find","_someNode","_everyNode","every","_concatNodeLists","slice","nodeLists","list","_getAllNodesWithTag","tagNames","tag","collection","getElementsByTagName","isArray","filter","cls","setAttribute","removeAttribute","firstElementChild","nextElementSibling","baseURI","documentURI","toAbsoluteURI","uri","charAt","URL","href","ex","links","link","childNodes","text","createTextNode","replaceChild","container","createElement","appendChild","medias","media","src","poster","srcset","newSrcset","replace","_","p1","p2","p3","includes","tagName","startsWith","_isElementWithoutContent","_removeAndGetNext","_hasSingleTagInsideElement","child","children","_getNextNode","_getArticleTitle","curTitle","origTitle","title","_getInnerText","e","titleHadHierarchicalSeparators","wordCount","str","headings","trimmedTitle","match","heading","substring","lastIndexOf","substr","hOnes","curTitleWordCount","_prepDocument","body","_replaceBrs","_nextNode","next","nextSibling","elem","br","replaced","brSibling","p","nextElem","_isPhrasingContent","sibling","lastChild","_isWhitespace","toLowerCase","replacement","ownerDocument","readability","_prepArticle","_cleanStyles","_markDataTables","_fixLazyImages","_cleanConditionally","_clean","shareElementThreshold","topCandidate","_cleanMatchedNodes","_cleanHeaders","paragraph","imgCount","embedCount","objectCount","iframeCount","totalCount","table","tbody","row","cell","_initializeNode","contentScore","_getClassWeight","nextNode","ignoreSelfAndKids","_textSimilarity","textA","textB","tokensA","Boolean","tokensB","uniqTokensB","token","distanceB","_checkByline","undefined","rel","itemprop","_isValidByline","_getNodeAncestors","maxDepth","ancestors","push","_grabArticle","page","isPaging","pageCacheHtml","stripUnlikelyCandidates","_flagIsActive","elementsToScore","shouldRemoveTitleHeader","_articleLang","_isProbablyVisible","_headerDuplicatesTitle","_hasAncestorTag","childNode","_getLinkDensity","newNode","_hasChildBlockElement","candidates","elementToScore","innerText","min","floor","ancestor","level","scoreDivider","topCandidates","c","cl","candidate","candidateScore","t","aTopCandidate","splice","pop","neededToCreateTopCandidate","parentOfTopCandidate","alternativeCandidateAncestors","MINIMUM_TOPCANDIDATES","listsContainingThisAncestor","ancestorIndex","Number","lastScore","scoreThreshold","parentScore","siblingScoreThreshold","max","siblings","s","sl","append","contentBonus","linkDensity","nodeContent","nodeLength","search","div","parseSuccessful","textLength","_removeFlag","sort","a","b","articleDir","String","_unescapeHtmlEntities","htmlEscapeMap","hex","numStr","num","parseInt","fromCharCode","_getJSONLD","scripts","metadata","jsonLdElement","content","parsed","JSON","parse","it","headline","nameMatches","headlineMatches","author","description","excerpt","publisher","siteName","err","message","_getArticleMetadata","jsonld","values","metaElements","propertyPattern","namePattern","element","elementName","elementProperty","_isSingleImage","_unwrapNoscriptImages","imgs","img","noscripts","noscript","tmp","prevElement","previousElementSibling","prevImg","newImg","attrName","_removeScripts","scriptNode","nodeValue","has","normalizeSpaces","_getCharCount","cur","linkLength","linkNode","coefficient","weight","isEmbed","depth","_getRowAndColumnCount","rows","columns","trs","rowspan","columnsInThisRow","cells","j","colspan","root","tables","role","_readabilityDataTable","datatable","summary","caption","dataTableDescendants","descendantExists","sizeInfo","parts","exec","srcCouldBeRemoved","b64starts","b64length","copyTo","_getTextDensity","tags","childrenLength","isDataTable","isList","listLength","listNodes","li","input","headingDensity","embeds","contentLength","haveToRemove","endOfSearchMarkerNode","headingNodes","shouldRemove","flag","numTags","jsonLd","paragraphs","dir","lang","require","app","initializers","Modal","ItemList","PostLoading","SplitDropdown","Button","DiscussionControls","listItems","PostControls","PostUser","PostMeta","PostEdited","LoadingIndicator","Separator","ArticleModal","oninit","vnode","discussion","attrs","includedPosts","firstPostControls","headerItemsFirstComment","docElm","document","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","params","requestParams","store","then","payload","included","discussionId","record","type","relationships","data","getById","createdAt","setPosts","lastTime","postIds","items","post","time","PostComponent","postComponents","contentType","component","number","controls","toArray","isEdited","isHidden","key","toISOString","dt","translator","trans","period","dayjs","fromNow","posts","m","redraw","bySlug","near","articleItems","commentItems","hide","fullscreenElement","exitFullscreen","error","state","close","extend","DiscussionPage","Model","Discussion","getBrowser","browser","handleBrowser","documentClone","cloneNode","article","modal","show","baseUrl","forum","attribute","read_url","shareUrl","window","open","userAgent","navigator","browserName","setPrototypeOf","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","__proto__"],"sourceRoot":""}